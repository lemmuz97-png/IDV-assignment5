<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Combined Assignments (Revised)</title>
    <style>
        /* --- Combined Root Variables from Assignments 2 and 3 --- */
        :root{
            /* A2 Variables */
            --thumb-w: 160px;
            --thumb-h: 160px;
            --gap: 12px;
            --border: 1px solid #ddd;
            --bg: #fafafa;
            --accent: #0b69ff; /* Blue */

            /* A3 Variables */
            --ink: #111827; /* Near Black for Text/Headers */
            --muted:#6b7280;
            --grid:#f3f4f6;
            --axis:#e5e7eb;
            --purple:#6d28d9;
            --purple-2:#8b5cf6;
            --teal:#0ea5a8;
            --gold:#f59e0b;
            --rose:#ef4444;
        }

        /* --- Overall Body and Container Styling --- */
        body {
            font-family: Inter, Roboto, system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 24px;
            background: var(--bg);
            color: var(--ink); /* Use ink for default text color */
        }

        .assignment-container {
            /* Ensures consistent width across all main sections */
            max-width: 850px; /* Set consistent max-width for A1, A2, and A3 content area */
            margin: 0 auto 4rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #ddd;
        }
        .assignment-container:last-child {
            border-bottom: none;
        }
        .assignment-container h2 {
            /* Global H2 Styling */
            font-size: 24px;
            margin-top: 0;
            margin-bottom: 1.5rem;
            color: var(--ink); /* Requested: All headers black */
            border-bottom: 2px solid var(--accent);
            padding-bottom: 0.5rem;
        }

        /* --- Assignment 1: PSI Readings Styles --- */
        .assignment-1 {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .assignment-1 h1 {
            /* Inner H1 Styling */
            margin-bottom: 0.25rem;
            font-size: 2rem;
            color: var(--ink); /* Requested: All headers black */
        }
        #timestamp {
            font-size: 0.9rem;
            color: var(--muted);
            margin-bottom: 1.5rem;
        }
        .assignment-1 table {
            border-collapse: collapse;
            width: 90%;
            max-width: 850px; /* Aligned with overall max-width */
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            overflow: hidden;
        }
        .assignment-1 th, .assignment-1 td {
            border: 1px solid #ddd;
            padding: 0.75rem 1rem;
            text-align: center;
        }
        .assignment-1 th {
            background-color: var(--accent); /* Consistent color palette */
            color: white;
        }
        .assignment-1 tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .assignment-1 caption {
            caption-side: bottom;
            font-size: 0.9rem;
            color: #555;
            margin-top: 0.5rem;
        }


        /* --- Assignment 2: SVG Effects Gallery Styles --- */
        .assignment-2 h1{
            font-size:20px;
            margin:0 0 8px;
            color: var(--ink); /* Requested: All headers black */
        }
        .assignment-2 p.small{color:#444;margin:0 0 18px;font-size:14px}
        table.gallery{
            border-collapse:collapse;
            width:100%;
            max-width:850px; /* Aligned with overall max-width */
            margin: 0 auto; /* Center the table within the section */
            background:white;
            box-shadow:0 6px 18px rgba(20,20,20,0.06)
        }
        table.gallery thead th{
            position:sticky;top:0;background:#fff;padding:10px;border-bottom:var(--border);text-align:center;font-weight:600;
            color: var(--ink); /* Requested: All headers black (table header) */
        }
        table.gallery td{padding:10px;text-align:center;border-bottom:var(--border);vertical-align:middle}
        .thumb{
            width:var(--thumb-w);
            height:var(--thumb-h);
            display:inline-block;
            object-fit:contain;
            border-radius:8px;
            box-shadow:0 4px 8px rgba(15,15,15,0.06);
            background:linear-gradient(180deg, #fff, #f7f9ff);
            padding:8px;
            border:1px solid #eee;
            transition:transform .25s ease, filter .25s ease;
        }

        /* effects - each applied individually (color palette used in JS) */
        .mirror{transform:scaleX(-1);}
        .rot180{transform:rotate(180deg);}
        .squeezeY{transform:scaleY(0.5);}
        .grayscale{filter:grayscale(100%);}

        /* labels under thumbnails */
        .cell-label{font-size:12px;color:#333;margin-top:8px}

        /* responsive tweak */
        @media (max-width:900px){
            :root{--thumb-w:120px;--thumb-h:120px}
        }
        @media (max-width:520px){
            table.gallery thead th:nth-child(n+3){display:none}
            table.gallery td:nth-child(n+3){display:none}
        }

        /* --- Assignment 3: Interactive Charts Styles --- */
        .wrap{
            /* This is the internal chart layout wrapper. Keeping its max-width narrow
            while the assignment container controls the overall width for alignment. */
            max-width:560px;
            margin:0 auto; /* Center within the 850px container */
            padding:8px;
            display:grid;
            gap:8px;
            grid-template-columns:1fr
        }
        .card{background:#fff;border:1px solid #eee;border-radius:12px;box-shadow:0 1px 4px rgba(0,0,0,.04);padding:6px 8px}
        .title{font-weight:800;margin:2px 2px 4px;font-size:16px;line-height:1.25; color: var(--ink);}
        .subtitle{margin:-2px 2px 6px;color:#6b7280;font-size:9px}
        .assignment-3 svg{width:100%;height:auto;background:#fff}
        .axis text, text.axis{font-size:8px;fill:#374151}
        .legend{font-size:9px;fill:#374151;cursor:pointer}
    </style>
</head>
<body>
    
    <div class="assignment-container">
        <h2>Assignment 1: Singapore PSI Readings</h2>
        <div class="assignment-1">
            <h1>Singapore PSI Readings</h1>
            <div id="timestamp">Loading latest data...</div>
            
            <table id="psiTable">
                <thead>
                    <tr id="header-row">
                        <th>Reading Type</th>
                    </tr>
                </thead>
                <tbody id="table-body"></tbody>
                <caption>Data source: <a href="https://api.data.gov.sg/v1/environment/psi" target="_blank">data.gov.sg PSI API</a></caption>
            </table>
        </div>
    </div>

    <div class="assignment-container">
        <h2>Assignment 2: SVG Effects Gallery</h2>
        <div class="assignment-2">
            <h1>SVG Effects — 10 files × 5 effects</h1>
            <p class="small">NOTE: This assignment requires an **'svgs' subfolder** containing **'svg1.svg'** through **'svg10.svg'** to be placed next to this HTML file for the images to load correctly.</p>
            
            <table class="gallery" id="gallery" aria-describedby="desc">
                <thead>
                    <tr>
                        <th>Original</th>
                        <th>Mirrored</th>
                        <th>Rotated 180°</th>
                        <th>Vertically Squeezed (50%)</th>
                        <th>Grayscale</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
    </div>

    <div class="assignment-container">
        <h2>Assignment 3: Interactive Charts</h2>
        <div class="assignment-3">
            <div class="wrap">
                <div class="card">
                    <div class="title">1) Optimisation Route</div>
                    <div class="subtitle">Click anywhere to set the goal; path re-routes along a smooth ribbon</div>
                    <svg id="c1" viewBox="0 0 460 170" aria-label="optimisation route"></svg>
                </div>

                <div class="card">
                    <div class="title">2) Frequency Area</div>
                    <div class="subtitle">Click a year to inspect; click legend to toggle series</div>
                    <svg id="c2" viewBox="0 0 520 160" aria-label="frequency area"></svg>
                </div>

                <div class="card">
                    <div class="title">3) Venn</div>
                    <div class="subtitle">Keep original shape/logic; labels minimal by default (click center to toggle I–VII)</div>
                    <svg id="c3" viewBox="0 0 480 180" aria-label="venn"></svg>
                </div>

                <div class="card">
                    <div class="title">4) Cross-Validation Accuracy</div>
                    <div class="subtitle">Click bars to cycle Value → Baseline → Gain; click whitespace to sort</div>
                    <svg id="c4" viewBox="0 0 480 150" aria-label="bars"></svg>
                </div>

                <div class="card">
                    <div class="title">5) Probability Density</div>
                    <div class="subtitle">Click twice to set an interval; shaded dominance & area % — peaks fully visible</div>
                    <svg id="c5" viewBox="0 0 480 150" aria-label="gaussians"></svg>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* --- Assignment 3: Chart Helpers (Must come first) --- */
        function svgEl(tag, attrs={}, children=[]){
            const el = document.createElementNS("http://www.w3.org/2000/svg", tag);
            for(const k in attrs){ el.setAttribute(k, attrs[k]); }
            for(const c of children){ el.appendChild(c); }
            return el;
        }
        function drawGrid(g, x, y, w, h, xStep, yStep){
            const grid = svgEl("g", {stroke:"var(--grid)", "stroke-width":"1"});
            for(let xx=x; xx<=x+w+0.1; xx+=xStep){ grid.appendChild(svgEl("line",{x1:xx,y1:y,x2:xx,y2:y+h})); }
            for(let yy=y; yy<=y+h+0.1; yy+=yStep){ grid.appendChild(svgEl("line",{x1:x,y1:yy,x2:x+w,y2:yy})); }
            g.appendChild(grid);
        }
        function drawAxes(g, x, y, w, h, xTicks, yTicks, xDomain, yDomain){
            const ga = svgEl("g",{"class":"axis"}); g.appendChild(ga);
            ga.appendChild(svgEl("line",{x1:x,y1:y+h,x2:x+w,y2:y+h,stroke:"var(--axis)"}));
            ga.appendChild(svgEl("line",{x1:x,y1:y,x2:x,y2:y+h,stroke:"var(--axis)"}));
            const [x0,x1] = xDomain, [y0,y1] = yDomain;
            for(let i=0;i<=xTicks;i++){
                const t=i/xTicks, xx=x+t*w;
                ga.appendChild(svgEl("line",{x1:xx,y1:y+h,x2:xx,y2:y+h+3,stroke:"var(--axis)"}));
                const val = x0+t*(x1-x0);
                const txt = svgEl("text",{x:xx,y:y+h+9,"text-anchor":"middle"},[]);
                txt.textContent = (Math.abs(val)<1e-6?0:val).toFixed(0); ga.appendChild(txt);
            }
            for(let i=0;i<=yTicks;i++){
                const t=i/yTicks, yy=y+(1-t)*h;
                ga.appendChild(svgEl("line",{x1:x-3,y1:yy,x2:x,y2:yy,stroke:"var(--axis)"}));
                const val = y0+t*(y1-y0);
                const txt = svgEl("text",{x:x-5,y:yy+2,"text-anchor":"end"},[]);
                txt.textContent = val.toFixed(0); ga.appendChild(txt);
            }
        }


        /* --- Assignment 1: PSI Readings Script --- */
        async function fetchPSIData() {
            try {
                const response = await fetch("https://api.data.gov.sg/v1/environment/psi");
                const data = await response.json();

                const item = data.items[0];
                const readings = item.readings;
                const regions = Object.keys(readings["psi_twenty_four_hourly"]); // e.g., north, south, etc.

                // Use both timestamps (fallback if one missing)
                const updateTime = item.update_timestamp || item.timestamp;
                const formattedTime = new Date(updateTime).toLocaleString("en-SG", {
                    timeZone: "Asia/Singapore",
                    dateStyle: "medium",
                    timeStyle: "short"
                });
                document.getElementById("timestamp").textContent = `Last updated: ${formattedTime}`;

                // Clear previous table content
                const headerRow = document.getElementById("header-row");
                const tableBody = document.getElementById("table-body");
                headerRow.innerHTML = "<th>Reading Type</th>";
                tableBody.innerHTML = "";

                // Build header
                regions.forEach(region => {
                    const th = document.createElement("th");
                    th.textContent = region.charAt(0).toUpperCase() + region.slice(1);
                    headerRow.appendChild(th);
                });

                // Build rows
                Object.entries(readings).forEach(([readingType, regionValues]) => {
                    const row = document.createElement("tr");

                    const typeCell = document.createElement("td");
                    typeCell.textContent = readingType;
                    row.appendChild(typeCell);

                    regions.forEach(region => {
                        const cell = document.createElement("td");
                        cell.textContent = regionValues[region];
                        row.appendChild(cell);
                    });

                    tableBody.appendChild(row);
                });

            } catch (error) {
                console.error("Error fetching PSI data:", error);
                document.getElementById("timestamp").textContent = "⚠️ Failed to load data.";
            }
        }

        fetchPSIData();


        /* --- Assignment 2: SVG Effects Gallery Script --- */
        (function(){
            // Configuration: update this array only if your files are named differently or in another folder
            const svgFolder = 'svgs'; // relative folder where svg1.svg ... svg10.svg live
            const files = Array.from({length:10}, (_,i)=>`svg${i+1}.svg`);

            const tbody = document.querySelector('#gallery tbody');

            function makeCell(src, className, alt){
                const td = document.createElement('td');

                // Use <img> to keep things simple and reliable across GitHub Pages.
                const img = document.createElement('img');
                img.className = 'thumb ' + (className||'');
                img.src = `${svgFolder}/${src}`;
                img.alt = alt || src;
                img.loading = 'lazy';
                img.decoding = 'async';

                const label = document.createElement('div');
                label.className = 'cell-label';
                label.textContent = alt || src;

                td.appendChild(img);
                td.appendChild(label);
                return td;
            }

            files.forEach(filename => {
                const tr = document.createElement('tr');

                // Original
                tr.appendChild(makeCell(filename, '', 'Original'));

                // Mirrored (left-right). Only this transform is applied — no filters.
                tr.appendChild(makeCell(filename, 'mirror', 'Mirrored'));

                // Rotated 180
                tr.appendChild(makeCell(filename, 'rot180', 'Rotated 180'));

                // Vertically squeezed by 50% (scaleY(0.5))
                tr.appendChild(makeCell(filename, 'squeezeY', 'Squeezed Y 50%'));

                // Grayscale filter
                tr.appendChild(makeCell(filename, 'grayscale', 'Grayscale'));

                tbody.appendChild(tr);
            });
        })();


        /* --- Assignment 3: Interactive Charts Scripts --- */
        /* ---------- 1: Optimisation Route ---------- */
        (function(){
            const svg = document.getElementById("c1");
            const W=460,H=170, m={t:6,r:6,b:16,l:24};
            const w=W-m.l-m.r, h=H-m.t-m.b;
            const g = svgEl("g",{transform:`translate(${m.l},${m.t})`}); svg.appendChild(g);
            drawGrid(g,0,0,w,h, w/10, h/6);
            drawAxes(g,0,0,w,h,8,4,[0,100],[0,100]);

            const path = svgEl("path",{fill:"none",stroke:"url(#grad1)","stroke-width":"1.8"});
            const ribbon = svgEl("path",{fill:"rgba(139,92,246,.12)"});
            const dots = svgEl("g",{});
            g.appendChild(ribbon); g.appendChild(path); g.appendChild(dots);

            const defs = svgEl("defs");
            const grad = svgEl("linearGradient",{id:"grad1",x1:"0%",x2:"100%"});
            grad.appendChild(svgEl("stop",{offset:"0%","stop-color":"var(--teal)"}));
            grad.appendChild(svgEl("stop",{offset:"100%","stop-color":"var(--purple)"}));
            defs.appendChild(grad); svg.appendChild(defs);

            let start = {x:10, y:86}, goal = {x:82, y:52};

            function stepRoute(s,g){
                const pts=[{x:s.x,y:s.y}]; let p={...s}, momentum={x:0,y:0};
                for(let i=0;i<90;i++){
                    const toG={x:g.x-p.x, y:g.y-p.y}; const d=Math.hypot(toG.x,toG.y); if(d<0.8) break;
                    const nx=toG.x/d, ny=toG.y/d; const jitter=(i/90)*0.9;
                    const dir={x:nx*0.9 + (Math.random()-0.5)*jitter*0.05 + momentum.x*0.3,
                                y:ny*0.9 + (Math.random()-0.5)*jitter*0.05 + momentum.y*0.3};
                    const len=Math.hypot(dir.x,dir.y)||1; dir.x/=len; dir.y/=len;
                    const step=0.85 + Math.tanh(d*0.1)*0.7;
                    p.x=Math.max(0,Math.min(100,p.x+dir.x*step));
                    p.y=Math.max(0,Math.min(100,p.y+dir.y*step));
                    momentum=dir; pts.push({x:p.x,y:p.y});
                } return pts;
            }
            function P(pts){ return pts.map((p,i)=> (i? "L":"M") + (p.x/100*w) + " " + ((100-p.y)/100*h)).join(" "); }
            function draw(pts){
                const off=0.9, up = pts.map(p=>({x:p.x, y:p.y+off})), dn = pts.map(p=>({x:p.x, y:p.y-off})).reverse();
                ribbon.setAttribute("d", P(up) + " L " + P(dn).slice(1) + " Z");
                const d = P(pts); path.setAttribute("d", d);
                const tmp = svgEl("path",{d}); const L = tmp.getTotalLength();
                path.setAttribute("stroke-dasharray", `${L} ${L}`); path.setAttribute("stroke-dashoffset", L);
                path.animate([{strokeDashoffset:L},{strokeDashoffset:0}], {duration:700, easing:"cubic-bezier(.2,.8,.2,1)", fill:"forwards"});
                dots.innerHTML=""; pts.forEach((p,i)=>{
                    if(i%16===0 || i===pts.length-1){
                        const c = svgEl("circle",{cx:(p.x/100*w), cy:((100-p.y)/100*h), r:0, fill:"var(--purple)"});
                        dots.appendChild(c); c.animate([{r:0},{r:2}], {duration:160, delay:120+i*4, fill:"forwards"});
                    }
                });
            }
            function newRoute(){ draw(stepRoute(start, goal)); } newRoute();

            svg.addEventListener("click",(e)=>{
                const pt = svg.createSVGPoint(); pt.x = e.clientX; pt.y = e.clientY;
                const local = pt.matrixTransform(svg.getScreenCTM().inverse());
                const x = Math.max(m.l, Math.min(W-m.r, local.x)) - m.l;
                const y = Math.max(m.t, Math.min(H-m.b, local.y)) - m.t;
                goal = {x: x/w*100, y: 100 - y/h*100};
                start = {x:8+Math.random()*12, y:80+Math.random()*14};
                newRoute();
            });
        })();

        /* ---------- 2: Frequency Area ---------- */
        (function(){
            const svg = document.getElementById("c2");
            const W=520,H=160, m={t:6,r:6,b:16,l:26};
            const w=W-m.l-m.r, h=H-m.t-m.b;
            const g = svgEl("g",{transform:`translate(${m.l},${m.t})`}); svg.appendChild(g);
            drawGrid(g,0,0,w,h, w/10, h/5);

            const years = []; for(let y=1980;y<=2023;y++) years.push(y);
            function base(y){ return Math.max(0, Math.sin((y-1980)/3)*0.8 + Math.cos((y-1994)/4)*0.6 + (y>2005? (y-2005)/8:0)); }
            const series = [
                {name:"Set", color:"var(--teal)"},
                {name:"Sequence", color:"var(--purple-2)"},
                {name:"Vector", color:"var(--gold)"},
                {name:"End-to-end", color:"var(--purple)"}
            ].map((s,i)=>{
                s.values = years.map(y=>({x:y, y: Math.max(0, base(y)*(i+1)/3 + (y>2010? (i===3? (y-2010)/6 : (i===2? (y-2012)/10:0)) : 0)) }));
                s.on = true; return s;
            });

            const x0=1980,x1=2023, y0=0, y1=Math.max(...series.flatMap(s=>s.values.map(v=>v.y)))+2;
            drawAxes(g,0,0,w,h,8,4,[x0,x1],[y0,y1]);

            function X(v){ return (v - x0)/(x1-x0)*w; }
            function Y(v){ return (1-(v - y0)/(y1-y0))*h; }

            const areas = series.map(s=>{
                const path = svgEl("path",{fill:s.color, stroke:s.color, "stroke-width":"1", opacity:"0.42"});
                g.appendChild(path); return {s, path};
            });
            function drawAreas(){
                areas.forEach(({s,path})=>{
                    if(!s.on){ path.setAttribute("d",""); return; }
                    const upper = s.values.map((v,i)=> (i? "L":"M") + X(v.x) + " " + Y(v.y)).join(" ");
                    const lower = "L " + X(x1) + " " + Y(0) + " L " + X(x0) + " " + Y(0) + " Z";
                    path.setAttribute("d", upper + " " + lower);
                });
            } drawAreas();

            // legend toggle
            const legend = svgEl("g",{}); svg.appendChild(legend);
            series.forEach((s,i)=>{
                const gx = 74 + i*118, gy = 10;
                const rect = svgEl("rect",{x:gx-12,y:gy-7,width:8,height:8,fill:s.color,opacity:1});
                const text = svgEl("text",{x:gx,y:gy,"alignment-baseline":"middle",class:"legend"},[]);
                text.textContent = s.name;
                const group = svgEl("g",{}); group.appendChild(rect); group.appendChild(text);
                legend.appendChild(group);
                group.addEventListener("click",()=>{ s.on=!s.on; rect.setAttribute("opacity", s.on?1:0.25); text.setAttribute("opacity", s.on?1:0.35); drawAreas(); });
            });

            // click to inspect year
            const marker = svgEl("line",{x1:0,y1:m.t, x2:0,y2:H-m.b, stroke:"var(--rose)","stroke-width":"1.1", opacity:"0"});
            svg.appendChild(marker);
            const pipG = svgEl("g",{}); svg.appendChild(pipG);
            svg.addEventListener("click",(e)=>{
                const pt = svg.createSVGPoint(); pt.x=e.clientX; pt.y=e.clientY;
                const local = pt.matrixTransform(svg.getScreenCTM().inverse());
                const x = Math.max(m.l, Math.min(W-m.r, local.x)) - m.l;
                const yYear = Math.round(x/w*(x1-x0) + x0);
                const xx = m.l + X(yYear);
                marker.setAttribute("x1",xx); marker.setAttribute("x2",xx); marker.setAttribute("opacity","1");
                pipG.innerHTML="";
                series.forEach(s=>{
                    if(!s.on) return;
                    const v = s.values.find(v=>v.x===yYear); if(!v) return;
                    const c = svgEl("circle",{cx:xx, cy:m.t+Y(v.y), r:0, fill:s.color, stroke:"#00000022","stroke-width":"1"});
                    const t = svgEl("text",{x:xx+4, y:m.t+Y(v.y)-4, "font-size":"9", fill:s.color},[]);
                    t.textContent = v.y.toFixed(1);
                    pipG.appendChild(c); pipG.appendChild(t); c.animate([{r:0},{r:3.6}], {duration:160, fill:"forwards"});
                });
            });
        })();

        /* ---------- 3: Venn (shape intact; much smaller; moved down) ---------- */
        (function(){
            const svg = document.getElementById("c3");
            const W=480,H=180, m={t:6,r:6,b:6,l:6};
            const w=W-m.l-m.r, h=H-m.t-m.b;
            const g = svgEl("g",{transform:`translate(${m.l},${m.t})`}); svg.appendChild(g);
            drawGrid(g,0,0,w,h, w/12, h/8);

            // original layout
            const R = 78;
            const cxL = w*0.40, cyL = h*0.62;
            const cxT = w*0.52, cyT = h*0.30;
            const cxR = w*0.68, cyR = h*0.60;

            // scale down and move downward so everything is visible
            const scale = 0.62;
            const offsetX = 22, offsetY = 26;    // moved down
            const gV = svgEl("g",{transform:`translate(${offsetX},${offsetY}) scale(${scale})`});
            g.appendChild(gV);

            const circles=[
                {x:cxL, y:cyL, r:R, fill:"rgba(139,92,246,.35)", stroke:"var(--purple)"},
                {x:cxT, y:cyT, r:R, fill:"rgba(14,165,168,.32)", stroke:"var(--teal)"},
                {x:cxR, y:cyR, r:R, fill:"rgba(245,158,11,.32)", stroke:"var(--gold)"}
            ];
            const cs = circles.map(c=>{
                const el = svgEl("circle",{cx:c.x, cy:c.y, r:c.r, fill:c.fill, stroke:c.stroke, "stroke-width":"1"});
                gV.appendChild(el); return {c, el, on:false};
            });
            function unhighlight(){ cs.forEach(o=>{ o.on=false; o.el.setAttribute("r",o.c.r); o.el.setAttribute("stroke-width","1"); o.el.setAttribute("opacity","0.95"); }); }
            cs.forEach(o=>{
                o.el.addEventListener("click",()=>{
                    const was = o.on; unhighlight();
                    if(!was){ o.on=true; o.el.animate([{r:o.c.r},{r:o.c.r*1.08}],{duration:220,fill:"forwards"});
                        o.el.setAttribute("stroke-width","1.6"); o.el.setAttribute("opacity","1");
                    }
                });
            });

            // default labels: I, II, III, VII (others toggle)
            const RG = svgEl("g",{}); gV.appendChild(RG);
            const centerX = (cxL+cxR)/2, centerY = (cyL+cyR)/2;
            function label(x,y,t,fs=11){ const tx = svgEl("text",{x,y,"font-size":String(fs),"font-weight":"700",fill:"#2f2f2f","text-anchor":"middle"},[]); tx.textContent=t; return tx; }
            RG.appendChild(label(centerX, centerY+2, "VII", 12));
            RG.appendChild(label(cxL - R*0.40, cyL + R*0.15, "I"));
            RG.appendChild(label(cxT, cyT + R*0.05, "II"));
            RG.appendChild(label(cxR + R*0.38, cyR + R*0.20, "III"));

            const RFull = svgEl("g",{opacity:"0"});
            RFull.appendChild(label(cxL + (cxT-cxL)*0.55, cyL - R*0.05, "IV"));
            RFull.appendChild(label(cxT + (cxR-cxT)*0.52, cyT + R*0.05, "V"));
            RFull.appendChild(label((cxL+cxR)/2 + 2, (cyL+cyR)/2 + R*0.18, "VI"));
            gV.appendChild(RFull);

            const centerBtn = svgEl("circle",{cx:centerX, cy:centerY, r:14, fill:"transparent"});
            centerBtn.style.cursor="pointer";
            centerBtn.addEventListener("click",()=>{
                const o = RFull.getAttribute("opacity")==="1";
                RFull.setAttribute("opacity", o? "0":"1");
            });
            gV.appendChild(centerBtn);
        })();

        /* ---------- 4: Bars ---------- */
        (function(){
            const svg = document.getElementById("c4");
            const W=480,H=150, m={t:6,r:6,b:20,l:30};
            const w=W-m.l-m.r, h=H-m.t-m.b;
            const g = svgEl("g",{transform:`translate(${m.l},${m.t})`}); svg.appendChild(g);
            drawGrid(g,0,0,w,h, w/6, h/5);
            drawAxes(g,0,0,w,h,6,5,[0,6],[0,100]);

            let cats=[
                {name:"BERT", val:74.4, base:64.8, mode:0},
                {name:"RoBERTa", val:81.9, base:65.5, mode:0},
                {name:"BART", val:73.1, base:63.5, mode:0}
            ];
            const bandW = w/(cats.length + (cats.length+1)*0.30), pad = bandW*0.30;
            function xBand(i){ return pad + i*(bandW+pad); }
            function y(v){ return (1-v/100)*h; }

            const ghosts=[], bars=[], labels=[];
            cats.forEach((d,i)=>{
                const gx = xBand(i), bw = bandW;
                const ghost = svgEl("rect",{x:gx,y:y(d.base),width:bw,height:h-y(d.base), fill:"none", stroke:"var(--purple-2)","stroke-width":"1.2","stroke-dasharray":"6 4",opacity:"0.9"});
                const bar = svgEl("rect",{x:gx,y:y(d.val),width:bw,height:h-y(d.val), fill:"var(--purple)", rx:"5"});
                g.appendChild(ghost); g.appendChild(bar);
                ghosts.push(ghost); bars.push(bar);
                const lab = svgEl("text",{x:gx+bw/2,y:y(d.val)-3,"text-anchor":"middle","font-weight":"700","font-size":"9",fill:"#333"},[]);
                lab.textContent = d.val.toFixed(1); g.appendChild(lab); labels.push(lab);

                bar.style.cursor="pointer";
                bar.addEventListener("click",()=>{
                    d.mode = (d.mode+1)%3; let H=0, YY=0, color="";
                    if(d.mode===0){ H=h-y(d.val); YY=y(d.val); color="var(--purple)"; }
                    if(d.mode===1){ H=h-y(d.base); YY=y(d.base); color="var(--teal)"; }
                    if(d.mode===2){ const delta=Math.max(0,d.val-d.base); H=h-y(delta); YY=y(delta); color="var(--gold)"; }
                    bar.setAttribute("y",YY); bar.setAttribute("height",H); bar.setAttribute("fill",color);
                    labels[i].textContent = d.mode===2? ("+"+(d.val-d.base).toFixed(1)) : (d.mode===1? d.base.toFixed(1): d.val.toFixed(1));
                    labels[i].setAttribute("y", YY-3);
                });
            });

            // click whitespace to sort by current value
            svg.addEventListener("click",(e)=>{
                if(e.target.tagName.toLowerCase()==="rect" || e.target.tagName.toLowerCase()==="circle") return;
                const byHeight = d=> d.mode===0? d.val : (d.mode===1? d.base : Math.max(0,d.val-d.base));
                cats = cats.sort((a,b)=> byHeight(b)-byHeight(a));
                cats.forEach((d,i)=>{
                    const gx = m.l + xBand(i);
                    bars[i].setAttribute("x", gx - m.l);
                    ghosts[i].setAttribute("x", gx - m.l);
                    labels[i].setAttribute("x", gx - m.l + bandW/2);
                });
            });
        })();

        /* ---------- 5: Probability Density (visible peaks) ---------- */
        (function(){
            const svg = document.getElementById("c5");
            const W=480,H=150, m={t:6,r:8,b:18,l:30};
            const w=W-m.l-m.r, h=H-m.t-m.b;
            const g = svgEl("g",{transform:`translate(${m.l},${m.t})`}); svg.appendChild(g);
            drawGrid(g,0,0,w,h, w/7, h/5);
            drawAxes(g,0,0,w,h,7,5,[-2,5],[0,50]); // 0..0.50 so peaks show

            function X(v){ return (v+2)/(5+2)*w; }
            function Y(v){ return (1-v/0.50)*h; }
            function norm(mu,s){ return x=> (1/(s*Math.sqrt(2*Math.PI)))*Math.exp(-0.5*((x-mu)/s)**2); }
            const f0 = norm(0.2,0.9), f1 = norm(2.0,0.8);
            const Xs = []; for(let x=-2; x<=5; x+=0.02) Xs.push(x);

            function linePath(data){ return data.map((d,i)=> (i? "L":"M") + X(d.x) + " " + Y(d.y)).join(" "); }
            const p0 = Xs.map(v=>({x:v,y:f0(v)})), p1 = Xs.map(v=>({x:v,y:f1(v)}));
            const path0 = svgEl("path",{d:linePath(p0), fill:"none", stroke:"var(--teal)","stroke-width":"1.6"});
            const path1 = svgEl("path",{d:linePath(p1), fill:"none", stroke:"var(--purple)","stroke-width":"1.6"});
            g.appendChild(path0); g.appendChild(path1);

            const area0 = svgEl("path",{fill:"rgba(14,165,168,.25)"});
            const area1 = svgEl("path",{fill:"rgba(109,40,217,.25)"});
            g.appendChild(area0); g.appendChild(area1);

            const vL = svgEl("line",{"stroke":"var(--rose)","stroke-dasharray":"6 4","display":"none"});
            const vR = svgEl("line",{"stroke":"var(--rose)","stroke-dasharray":"6 4","display":"none"});
            g.appendChild(vL); g.appendChild(vR);

            const chip = svgEl("g",{transform:`translate(${X(3.0)},${Y(0.45)})`, opacity:"0"});
            chip.appendChild(svgEl("rect",{width:"148",height:"16",rx:"7",fill:"var(--purple)"}));
            const chipText = svgEl("text",{x:"7", y:"12", fill:"#fff", "font-size":"8","font-weight":"700"},[]);
            chipText.textContent="area: — / —"; chip.appendChild(chipText); g.appendChild(chip);

            let left=null, right=null;
            function updateShade(){
                if(left===null || right===null) return;
                const lo=Math.min(left,right), hi=Math.max(left,right);
                const xs = Xs.filter(v=>v>=lo && v<=hi);
                const dom0 = xs.filter(v=>f0(v)>=f1(v));
                const dom1 = xs.filter(v=>f1(v)>f0(v));
                function areaPath(xs, f){
                    if(xs.length===0) return "";
                    const top = xs.map((v,i)=> (i? "L":"M") + X(v) + " " + Y(f(v))).join(" ");
                    const base = "L " + X(xs[xs.length-1]) + " " + Y(0) + " L " + X(xs[0]) + " " + Y(0) + " Z";
                    return top + " " + base;
                }
                area0.setAttribute("d", areaPath(dom0, f0));
                area1.setAttribute("d", areaPath(dom1, f1));
                vL.setAttribute("x1",X(lo)); vL.setAttribute("x2",X(lo)); vL.setAttribute("y1",0); vL.setAttribute("y2",h); vL.removeAttribute("display");
                vR.setAttribute("x1",X(hi)); vR.setAttribute("x2",X(hi)); vR.setAttribute("y1",0); vR.setAttribute("y2",h); vR.removeAttribute("display");

                const dx = Xs[1]-Xs[0]; let a0=0, a1=0;
                xs.forEach(v=>{ if(f0(v)>=f1(v)) a0+=f0(v)*dx; else a1+=f1(v)*dx; });
                const total = a0+a1 || 1;
                chipText.textContent = `area: teal ${(a0/total*100).toFixed(0)}% · purple ${(a1/total*100).toFixed(0)}%`;
                chip.setAttribute("opacity","1");
            }

            svg.addEventListener("click",(e)=>{
                const pt = svg.createSVGPoint(); pt.x=e.clientX; pt.y=e.clientY;
                const local = pt.matrixTransform(svg.getScreenCTM().inverse());
                const x = Math.max(m.l, Math.min(W-m.r, local.x)) - m.l;
                const xv = (x/w)*(5+2) - 2;
                if(left===null){ left = xv; }
                else if(right===null){ right = xv; }
                else { left = xv; right = null; area0.setAttribute("d",""); area1.setAttribute("d",""); chip.setAttribute("opacity","0"); vL.setAttribute("display","none"); vR.setAttribute("display","none"); }
                updateShade();
            });
        })();
    </script>
</body>
</html>
