<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Consolidated IDV Assignments (1-4) - All Sections Visible</title>
   
    <script src="https://d3js.org/d3.v7.min.js"></script>
   
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-accent': '#6b7280',
                        'tab-inactive': '#9ca3af',
                        'light-bg': '#f7f9fb', 
                    },
                }
            }
        }
    </script>

    <style>
       
        body {
            background-color: #f6f8fa;
            color: #111827;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 2rem 1rem;
        }

        .main-wrapper {
            width: 100%;
            max-width: 900px; 
            background: transparent;
        }
       
        .content-container {
            width: 100%;
            padding: 1rem 0; 
        }
       
        hr { border-top: 2px solid #e5e7eb; margin: 3rem 0; }

     
        header { 
            text-align: left; 
            width: 100%; 
            margin-bottom: 2rem;
        }
     
        header h1 {
            font-size: 30px;
            font-weight: 800; 
            color: #111827;
            text-align: left;
            border-bottom: none; 
            padding-bottom: 0; 
            margin-top: 0;
            margin-bottom: 0.5rem;
            line-height: 1.2;
        }


        .section-header-2 { 
            font-size: 24px; 
            font-weight: 700; 
            color: #111827;
            text-align: left; 
            padding-bottom: 5px; 
            border-bottom: 2px solid black; 
            margin-top: 3rem; 
            margin-bottom: 1.5rem;
            line-height: 1.2;
        }
       
        h3.text-xl.font-semibold.text-center.mt-6.mb-4.text-gray-800,
        h3.text-xl.font-semibold.text-center.mt-12.mb-4.text-gray-800 {
            font-size: 18px; 
            font-weight: 600;
            text-align: left; 
            color: #6b7280; 
            margin-top: 1.5rem;
            margin-bottom: 0.8rem;
            border-bottom: none; 
            padding-bottom: 0;
        }
        
       
        .intro-body-text {
            text-align: justify;
            margin-top: 1rem;
            margin-bottom: 2rem;
            line-height: 1.6;
            color: #374151; 
        }


       
        #content-consolidated h1 { 
            font-size: 24px; font-weight: 700; margin-bottom: 1rem; display: block; 
            text-align: left; 
            padding-bottom: 5px; 
            border-bottom: 2px solid black;
            margin-top: 3rem; 
            margin-bottom: 1.5rem;
        }
       
       
        #psiTable { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 1rem; }
        #psiTable th, #psiTable td { border: 1px solid #ddd; padding: 12px; text-align: center; }
        #psiTable th { background-color: #007aff; color: white; font-weight: bold; }
        #psiTable tr:nth-child(even) { background-color: #f9f9f9; }

       
        .gallery-wrapper {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            padding: 1rem;
        }
        table.gallery { width: 100%; border-collapse: collapse; background: white; margin-bottom: 0; }
        table.gallery th, table.gallery td { border-bottom: 1px solid #ddd; padding: 10px; text-align: center; vertical-align: middle; }
        table.gallery th { font-weight: 600; background: #fff; position: sticky; top: 0; }
        .thumb {
            width: 120px; height: 120px;
            object-fit: contain; border: 1px solid #eee; padding: 5px; background: #fff;
            border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.2s, filter 0.2s;
        }
        .mirror { transform: scaleX(-1); } .rot180 { transform: rotate(180deg); } 
        .squeezeY { transform: scaleY(0.5); } .grayscale { filter: grayscale(100%); }

        
        .a3-chart-wrapper {
            
            width: 100%;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 1rem;
        }

        .a3-card {
            
            margin: 1rem auto;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 10px;
           
            
            max-width: 540px; 
            width: 100%; 
        }
        .a3-title { font-weight: 800; font-size: 14px; margin-bottom: 4px; }
        .a3-sub { font-size: 10px; color: #666; margin-bottom: 8px; }
        .a3-chart-wrapper .axis text, .a3-chart-wrapper .axis-label, .axis text { font-size: 8px; fill: #374151; }
        .a3-chart-wrapper .legend{font-size:9px;fill:#374151;cursor:pointer}


        .chart-container { background: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        #heatmap, #linechart { width: 100%; height: auto; }
        .tooltip { position: absolute; padding: 8px 12px; font-size: 14px; background: #1f2937; color: white; border-radius: 6px; pointer-events: none; opacity: 0; transition: opacity 0.2s; z-index: 50; }
       
        
        .axis-label { fill: #374151; font-weight: 500; font-size: 12px; }
    </style>
</head>
<body>

    <div class="main-wrapper">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-800">ASSIGNMENT 5: UNIFIED ASSIGNMENTS 1-4</h1>
            
        </header>
        
        
        <div class="intro-body-text">
            This webpage presents fulfilled Assignment 5, which consists of a set of interactive data-visualizations and consolidates 4 previous assignments of the course. As per requirements of Assignmen 5, these assignments are merged into one webpage by extracting the **body** content and injecting it into a styled **section**, and then displaying all of them inside a unified design, which I had to adjust throughout the page, so all the parts of the assignment look consistent stylistically. For instance, I left aligned all the headers and made sure they are of the same size and color; placed each assignment into a container with rounded corners and of the same width. There have been some structural difficulties faced during completion of this assignment. Namely, one of the assignments loaded D3.js external library while others contained inline JS, while all the separate assignment webpages were built in a way that they are running on their separate pages, not on one page altogether. Also, some scripts were overwriting other variables. However, the biggest challenge was to resolve the CSS conflicts by isolating them, since each assignment used its own styling and combining them was breaking the layout. Assignment 3 and 4 were the hardest to merge, beacuse they are both heavy on JavaScript code and used D3.js libraries, which were overwriting each other since they both defined certain global variables.
        </div>
        

        <div id="content-consolidated" class="content-container block">
           
            <section>
                <h2 class="section-header-2">Assignment 1: PSI Readings</h2>
                <div class="content-container">
                    <div id="timestamp" class="text-center text-sm text-gray-500 mb-4">Loading data...</div>
                    <table id="psiTable">
                        <thead><tr id="header-row"><th>Reading Type</th></tr></thead>
                        <tbody id="table-body"></tbody>
                    </table>
                </div>
            </section>

            <hr/>

            <section>
                <h2 class="section-header-2">Assignment 2: SVG Effects</h2>
                <div class="content-container text-center gallery-wrapper">
                    
                    <div style="overflow-x: auto;">
                        <table class="gallery" id="gallery">
                            <thead>
                                <tr>
                                    <th>Original</th><th>Mirrored</th><th>Rotated</th><th>Squeezed</th><th>Grayscale</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <hr/>

            <section>
                <h2 class="section-header-2">Assignment 3: Interactive Charts (Original Proportions)</h2>
               
                <div class="a3-chart-wrapper"> 
                   
                    <div class="a3-card">
                        <div class="a3-title">1) Optimisation Route</div>
                        <div class="a3-sub">Click anywhere to set the goal; path re-routes along a smooth ribbon</div>
                        <svg id="c1" viewBox="0 0 460 170" aria-label="optimisation route"></svg>
                    </div>
                    <div class="a3-card">
                        <div class="a3-title">2) Frequency Area</div>
                        <div class="a3-sub">Click a year to inspect; click legend to toggle series</div>
                        <svg id="c2" viewBox="0 0 520 160" aria-label="frequency area"></svg>
                    </div>
                    <div class="a3-card">
                        <div class="a3-title">3) Venn</div>
                        <div class="a3-sub">Keep original shape/logic; labels minimal by default (click center to toggle I–VII)</div>
                        <svg id="c3" viewBox="0 0 480 180" aria-label="venn"></svg>
                    </div>
                    <div class="a3-card">
                        <div class="a3-title">4) Cross-Validation Accuracy</div>
                        <div class="a3-sub">Click bars to cycle Value → Baseline → Gain; click whitespace to sort</div>
                        <svg id="c4" viewBox="0 0 480 150" aria-label="bars"></svg>
                    </div>
                    <div class="a3-card">
                        <div class="a3-title">5) Probability Density</div>
                        <div class="a3-sub">Click twice to set an interval; shaded dominance & area % — peaks fully visible</div>
                        <svg id="c5" viewBox="0 0 480 150" aria-label="gaussians"></svg>
                    </div>
                </div>
            </section>

            <hr/>

            <section>
                <h2 class="section-header-2">Assignment 4: Advanced Visualizations</h2>

                <h3 class="text-xl font-semibold text-center mt-6 mb-4 text-gray-800">A4: Heatmap</h3>
               
                <div class="content-container">
                    <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-6 p-4 bg-white rounded-xl shadow-sm border border-gray-100">
                        <label for="metric-select" class="font-semibold text-primary-accent">Select Metric:</label>
                        <select id="metric-select" class="p-2 rounded border border-gray-300 focus:ring-2 focus:ring-indigo-500 outline-none">
                            <option value="Std Acc">Standard Accuracy</option>
                            <option value="CRR">Certified Robustness Rate</option>
                            <option value="CRA">Certified Robust Accuracy</option>
                        </select>
                    </div>

                    <div class="chart-container p-4 mb-6">
                        <svg id="heatmap" viewBox="0 0 800 500"></svg>
                    </div>

                    <div class="chart-container p-4">
                        <h3 class="text-sm font-semibold mb-2 text-center text-gray-500">Color Scale</h3>
                        <svg id="legend" width="100%" height="40"></svg>
                    </div>
                </div>
                <h3 class="text-xl font-semibold text-center mt-12 mb-4 text-gray-800">A4: Line Chart</h3>
               
                <div class="content-container">
                    <div class="chart-container p-4 mb-6">
                        <h3 class="text-sm font-bold text-primary-accent mb-3 border-b pb-2">Toggle Approaches:</h3>
                        <div id="approach-controls" class="flex flex-wrap gap-3 justify-center"></div>
                    </div>

                    <div class="chart-container p-4">
                        <svg id="linechart" viewBox="0 0 900 500"></svg>
                    </div>
                </div>
                </section>
        </div>


        <div id="tooltip" class="tooltip"></div>

    </div> 
   
    <script>
        
        function svgEl(tag, attrs={}, children=[]){
            const el = document.createElementNS("http://www.w3.org/2000/svg", tag);
            for(const k in attrs){ el.setAttribute(k, attrs[k]); }
            for(const c of children){ el.appendChild(c); }
            return el;
        }
        function drawGrid(g, x, y, w, h, xStep, yStep){
            const grid = svgEl("g", {stroke:"#f3f4f6", "stroke-width":"1"});
            for(let xx=x; xx<=x+w+0.1; xx+=xStep){ grid.appendChild(svgEl("line",{x1:xx,y1:y,x2:xx,y2:y+h})); }
            for(let yy=y; yy<=y+h+0.1; yy+=yStep){ grid.appendChild(svgEl("line",{x1:x,y1:yy,x2:x+w,y2:yy})); }
            g.appendChild(grid);
        }
        function drawAxes(g, x, y, w, h, xTicks, yTicks, xDomain, yDomain){
            const axisColor = "#e5e7eb";
            const ga = svgEl("g",{"class":"axis"}); g.appendChild(ga);
            ga.appendChild(svgEl("line",{x1:x,y1:y+h,x2:x+w,y2:y+h,stroke:axisColor}));
            ga.appendChild(svgEl("line",{x1:x,y1:y,x2:x,y2:y+h,stroke:axisColor}));
            const [x0,x1] = xDomain, [y0,y1] = yDomain;
            for(let i=0;i<=xTicks;i++){
                const t=i/xTicks, xx=x+t*w;
                ga.appendChild(svgEl("line",{x1:xx,y1:y+h,x2:xx,y2:y+h+3,stroke:axisColor}));
                const val = x0+t*(x1-x0);
                const txt = svgEl("text",{x:xx,y:y+h+9,"text-anchor":"middle", "class":"axis"},[]);
                txt.textContent = (Math.abs(val)<1e-6?0:val).toFixed(0); ga.appendChild(txt);
            }
            for(let i=0;i<=yTicks;i++){
                const t=i/yTicks, yy=y+(1-t)*h;
                ga.appendChild(svgEl("line",{x1:x-3,y1:yy,x2:x,y2:yy,stroke:axisColor}));
                const val = y0+t*(y1-y0);
                const txt = svgEl("text",{x:x-5,y:yy+2,"text-anchor":"end", "class":"axis"},[]);
                txt.textContent = val.toFixed(0); ga.appendChild(txt);
            }
        }



        
        function initAllScripts() {
           
            (async function() {
                try {
                    const res = await fetch("https://api.data.gov.sg/v1/environment/psi");
                    const data = await res.json();
                    const r = data.items[0].readings;
                    const regions = Object.keys(r["psi_twenty_four_hourly"]);
                   
                    document.getElementById("timestamp").textContent = "Updated: " + new Date(data.items[0].update_timestamp).toLocaleString();
                    const hRow = document.getElementById("header-row");
                    const body = document.getElementById("table-body");
                   
                    hRow.innerHTML = "<th>Reading Type</th>";
                    body.innerHTML = "";
                   
                    regions.forEach(reg => {
                        const th = document.createElement("th");
                        th.textContent = reg.charAt(0).toUpperCase() + reg.slice(1);
                        hRow.appendChild(th);
                    });

                    Object.entries(r).forEach(([type, vals]) => {
                        const tr = document.createElement("tr");
                        const td1 = document.createElement("td");
                        td1.textContent = type;
                        tr.appendChild(td1);
                        regions.forEach(reg => {
                            const td = document.createElement("td");
                            td.textContent = vals[reg];
                            tr.appendChild(td);
                        });
                        body.appendChild(tr);
                    });
                } catch(e) { document.getElementById("timestamp").textContent = "Failed to load PSI data"; }
            })();

           
            (function(){
                const files = Array.from({length:10}, (_,i)=>`svg${i+1}.svg`);
                const tbody = document.querySelector('#gallery tbody');
                if(!tbody) return;
               
                tbody.innerHTML = "";
               
                files.forEach(f => {
                    const tr = document.createElement('tr');
                    ['', 'mirror', 'rot180', 'squeezeY', 'grayscale'].forEach((effect, i) => {
                        const td = document.createElement('td');
                        const img = document.createElement('img');
                        img.className = 'thumb ' + effect;
                        img.src = 'svgs/' + f;
                        img.alt = i === 0 ? 'Original' : effect;
                        td.appendChild(img);
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });
            })();

           
            const A3_PURPLE = '#6d28d9', A3_PURPLE_2 = '#8b5cf6', A3_TEAL = '#0ea5a8', A3_GOLD = '#f59e0b', A3_ROSE = '#ef4444';

           
            (function(){
                const svg = document.getElementById("c1"); if(!svg) return;
                svg.innerHTML = '';
                const W=460,H=170, m={t:6,r:6,b:16,l:24};
                const w=W-m.l-m.r, h=H-m.t-m.b;
                const g = svgEl("g",{transform:`translate(${m.l},${m.t})`}); svg.appendChild(g);
                drawGrid(g,0,0,w,h, w/10, h/6);
                drawAxes(g,0,0,w,h,8,4,[0,100],[0,100]);

                const path = svgEl("path",{fill:"none",stroke:"url(#grad1)","stroke-width":"1.8"});
                const ribbon = svgEl("path",{fill:"rgba(139,92,246,.12)"});
                const dots = svgEl("g",{});
                g.appendChild(ribbon); g.appendChild(path); g.appendChild(dots);

                const defs = svgEl("defs");
                const grad = svgEl("linearGradient",{id:"grad1",x1:"0%",x2:"100%"});
                grad.appendChild(svgEl("stop",{offset:"0%","stop-color":A3_TEAL}));
                grad.appendChild(svgEl("stop",{offset:"100%","stop-color":A3_PURPLE}));
                defs.appendChild(grad); svg.appendChild(defs);

                let start = {x:10, y:86}, goal = {x:82, y:52};

                function stepRoute(s,g){
                    const pts=[{x:s.x,y:s.y}]; let p={...s}, momentum={x:0,y:0};
                    for(let i=0;i<90;i++){
                        const toG={x:g.x-p.x, y:g.y-p.y}; const d=Math.hypot(toG.x,toG.y); if(d<0.8) break;
                        const nx=toG.x/d, ny=toG.y/d; const jitter=(i/90)*0.9;
                        const dir={x:nx*0.9 + (Math.random()-0.5)*jitter*0.05 + momentum.x*0.3, y:ny*0.9 + (Math.random()-0.5)*jitter*0.05 + momentum.y*0.3};
                        const len=Math.hypot(dir.x,dir.y)||1; dir.x/=len; dir.y/=len;
                        const step=0.85 + Math.tanh(d*0.1)*0.7;
                        p.x=Math.max(0,Math.min(100,p.x+dir.x*step));
                        p.y=Math.max(0,Math.min(100,p.y+dir.y*step));
                        momentum=dir; pts.push({x:p.x,y:p.y});
                    } return pts;
                }
                function P(pts){ return pts.map((p,i)=> (i? "L":"M") + (p.x/100*w) + " " + ((100-p.y)/100*h)).join(" "); }
                function draw(pts){
                    const off=0.9, up = pts.map(p=>({x:p.x, y:p.y+off})), dn = pts.map(p=>({x:p.x, y:p.y-off})).reverse();
                    ribbon.setAttribute("d", P(up) + " L " + P(dn).slice(1) + " Z");
                    const d = P(pts); path.setAttribute("d", d);
                    const tmp = svgEl("path",{d}); const L = tmp.getTotalLength();
                    path.setAttribute("stroke-dasharray", `${L} ${L}`); path.setAttribute("stroke-dashoffset", L);
                    path.animate([{strokeDashoffset:L},{strokeDashoffset:0}], {duration:700, easing:"cubic-bezier(.2,.8,.2,1)", fill:"forwards"});
                    dots.innerHTML=""; pts.forEach((p,i)=>{
                        if(i%16===0 || i===pts.length-1){
                            const c = svgEl("circle",{cx:(p.x/100*w), cy:((100-p.y)/100*h), r:0, fill:A3_PURPLE});
                            dots.appendChild(c); c.animate([{r:0},{r:2}], {duration:160, delay:120+i*4, fill:"forwards"});
                        }
                    });
                }
                function newRoute(){ draw(stepRoute(start, goal)); } newRoute();

                svg.addEventListener("click",(e)=>{
                    const pt = svg.createSVGPoint(); pt.x = e.clientX; pt.y = e.clientY;
                    const local = pt.matrixTransform(svg.getScreenCTM().inverse());
                    const x = Math.max(m.l, Math.min(W-m.r, local.x)) - m.l;
                    const y = Math.max(m.t, Math.min(H-m.b, local.y)) - m.t;
                    goal = {x: x/w*100, y: 100 - y/h*100};
                    start = {x:8+Math.random()*12, y:80+Math.random()*14};
                    newRoute();
                });
            })();

            
            (function(){
                const svg = document.getElementById("c2"); if(!svg) return;
                svg.innerHTML = '';
                const W=520,H=160, m={t:6,r:6,b:16,l:26};
                const w=W-m.l-m.r, h=H-m.t-m.b;
                const g = svgEl("g",{transform:`translate(${m.l},${m.t})`}); svg.appendChild(g);
                drawGrid(g,0,0,w,h, w/10, h/5);

                const years = []; for(let y=1980;y<=2023;y++) years.push(y);
                function base(y){ return Math.max(0, Math.sin((y-1980)/3)*0.8 + Math.cos((y-1994)/4)*0.6 + (y>2005? (y-2005)/8:0)); }
                const series = [
                    {name:"Set", color:A3_TEAL},
                    {name:"Sequence", color:A3_PURPLE_2},
                    {name:"Vector", color:A3_GOLD},
                    {name:"End-to-end", color:A3_PURPLE}
                ].map((s,i)=>{
                    s.values = years.map(y=>({x:y, y: Math.max(0, base(y)*(i+1)/3 + (y>2010? (i===3? (y-2010)/6 : (i===2? (y-2012)/10:0)) : 0)) }));
                    s.on = true; return s;
                });

                const x0=1980,x1=2023, y0=0, y1=Math.max(...series.flatMap(s=>s.values.map(v=>v.y)))+2;
                drawAxes(g,0,0,w,h,8,4,[x0,x1],[y0,y1]);

                function X(v){ return (v - x0)/(x1-x0)*w; }
                function Y(v){ return (1-(v - y0)/(y1-y0))*h; }

                const areas = series.map(s=>{
                    const path = svgEl("path",{fill:s.color, stroke:s.color, "stroke-width":"1", opacity:"0.42"});
                    g.appendChild(path); return {s, path};
                });
                function drawAreas(){
                    areas.forEach(({s,path})=>{
                        if(!s.on){ path.setAttribute("d",""); return; }
                        const upper = s.values.map((v,i)=> (i? "L":"M") + X(v.x) + " " + Y(v.y)).join(" ");
                        const lower = "L " + X(x1) + " " + Y(0) + " L " + X(x0) + " " + Y(0) + " Z";
                        path.setAttribute("d", upper + " " + lower);
                    });
                } drawAreas();

               
                const legend = svgEl("g",{}); svg.appendChild(legend);
                series.forEach((s,i)=>{
                    const gx = 74 + i*118, gy = 10;
                    const rect = svgEl("rect",{x:gx-12,y:gy-7,width:8,height:8,fill:s.color,opacity:1});
                    const text = svgEl("text",{x:gx,y:gy,"alignment-baseline":"middle",class:"legend"},[]);
                    text.textContent = s.name;
                    const group = svgEl("g",{}); group.appendChild(rect); group.appendChild(text);
                    legend.appendChild(group);
                    group.addEventListener("click",()=>{ s.on=!s.on; rect.setAttribute("opacity", s.on?1:0.25); text.setAttribute("opacity", s.on?1:0.35); drawAreas(); });
                });

                
                const marker = svgEl("line",{x1:0,y1:m.t, x2:0,y2:H-m.b, stroke:A3_ROSE,"stroke-width":"1.1", opacity:"0"});
                svg.appendChild(marker);
                const pipG = svgEl("g",{}); svg.appendChild(pipG);
                svg.addEventListener("click",(e)=>{
                    const pt = svg.createSVGPoint(); pt.x=e.clientX; pt.y=e.clientY;
                    const local = pt.matrixTransform(svg.getScreenCTM().inverse());
                    const x = Math.max(m.l, Math.min(W-m.r, local.x)) - m.l;
                    const yYear = Math.round(x/w*(x1-x0) + x0);
                    const xx = m.l + X(yYear);
                    marker.setAttribute("x1",xx); marker.setAttribute("x2",xx); marker.setAttribute("opacity","1");
                    pipG.innerHTML="";
                    series.forEach(s=>{
                        if(!s.on) return;
                        const v = s.values.find(v=>v.x===yYear); if(!v) return;
                        const c = svgEl("circle",{cx:xx, cy:m.t+Y(v.y), r:0, fill:s.color, stroke:"#00000022","stroke-width":"1"});
                        const t = svgEl("text",{x:xx+4, y:m.t+Y(v.y)-4, "font-size":"9", fill:s.color},[]);
                        t.textContent = v.y.toFixed(1);
                        pipG.appendChild(c); pipG.appendChild(t); c.animate([{r:0},{r:3.6}], {duration:160, fill:"forwards"});
                    });
                });
            })();

    
            (function(){
                const svg = document.getElementById("c3"); if(!svg) return;
                svg.innerHTML = '';
                const W=480,H=180, m={t:6,r:6,b:6,l:6};
                const w=W-m.l-m.r, h=H-m.t-m.b;
                const g = svgEl("g",{transform:`translate(${m.l},${m.t})`}); svg.appendChild(g);
                drawGrid(g,0,0,w,h, w/12, h/8);

                const R = 78;
                const cxL = w*0.40, cyL = h*0.62;
                const cxT = w*0.52, cyT = h*0.30;
                const cxR = w*0.68, cyR = h*0.60;

                const scale = 0.62;
                const offsetX = 22, offsetY = 26;
                const gV = svgEl("g",{transform:`translate(${offsetX},${offsetY}) scale(${scale})`});
                g.appendChild(gV);

                const circles=[
                    {x:cxL, y:cyL, r:R, fill:`rgba(139,92,246,.35)`, stroke:A3_PURPLE},
                    {x:cxT, y:cyT, r:R, fill:`rgba(14,165,168,.32)`, stroke:A3_TEAL},
                    {x:cxR, y:cyR, r:R, fill:`rgba(245,158,11,.32)`, stroke:A3_GOLD}
                ];
                const cs = circles.map(c=>{
                    const el = svgEl("circle",{cx:c.x, cy:c.y, r:c.r, fill:c.fill, stroke:c.stroke, "stroke-width":"1"});
                    gV.appendChild(el); return {c, el, on:false};
                });
                function unhighlight(){ cs.forEach(o=>{ o.on=false; o.el.setAttribute("r",o.c.r); o.el.setAttribute("stroke-width","1"); o.el.setAttribute("opacity","0.95"); }); }
                cs.forEach(o=>{
                    o.el.addEventListener("click",()=>{
                        const was = o.on; unhighlight();
                        if(!was){ o.on=true; o.el.animate([{r:o.c.r},{r:o.c.r*1.08}],{duration:220,fill:"forwards"});
                        o.el.setAttribute("stroke-width","1.6"); o.el.setAttribute("opacity","1");
                        }
                    });
                });

                const RG = svgEl("g",{}); gV.appendChild(RG);
                const centerX = (cxL+cxR)/2, centerY = (cyL+cyR)/2;
                function label(x,y,t,fs=11){ const tx = svgEl("text",{x,y,"font-size":String(fs),"font-weight":"700",fill:"#2f2f2f","text-anchor":"middle"},[]); tx.textContent=t; return tx; }
                RG.appendChild(label(centerX, centerY+2, "VII", 12));
                RG.appendChild(label(cxL - R*0.40, cyL + R*0.15, "I"));
                RG.appendChild(label(cxT,      cyT + R*0.05, "II"));
                RG.appendChild(label(cxR + R*0.38, cyR + R*0.20, "III"));

                const RFull = svgEl("g",{opacity:"0"});
                RFull.appendChild(label(cxL + (cxT-cxL)*0.55, cyL - R*0.05, "IV"));
                RFull.appendChild(label(cxT + (cxR-cxT)*0.52, cyT + R*0.05, "V"));
                RFull.appendChild(label((cxL+cxR)/2 + 2, (cyL+cyR)/2 + R*0.18, "VI"));
                gV.appendChild(RFull);

                const centerBtn = svgEl("circle",{cx:centerX, cy:centerY, r:14, fill:"transparent"});
                centerBtn.style.cursor="pointer";
                centerBtn.addEventListener("click",()=>{
                    const o = RFull.getAttribute("opacity")==="1";
                    RFull.setAttribute("opacity", o? "0":"1");
                });
                gV.appendChild(centerBtn);
            })();

            
            (function(){
                const svg = document.getElementById("c4"); if(!svg) return;
                svg.innerHTML = '';
                const W=480,H=150, m={t:6,r:6,b:20,l:30};
                const w=W-m.l-m.r, h=H-m.t-m.b;
                const g = svgEl("g",{transform:`translate(${m.l},${m.t})`}); svg.appendChild(g);
                drawGrid(g,0,0,w,h, w/6, h/5);
                drawAxes(g,0,0,w,h,6,5,[0,6],[0,100]);

                let cats=[
                    {name:"BERT", val:74.4, base:64.8, mode:0},
                    {name:"RoBERTa", val:81.9, base:65.5, mode:0},
                    {name:"BART", val:73.1, base:63.5, mode:0}
                ];
                const bandW = w/(cats.length + (cats.length+1)*0.30), pad = bandW*0.30;
                function xBand(i){ return pad + i*(bandW+pad); }
                function y(v){ return (1-v/100)*h; }

                const ghosts=[], bars=[], labels=[];
                cats.forEach((d,i)=>{
                    const gx = xBand(i), bw = bandW;
                    const ghost = svgEl("rect",{x:gx,y:y(d.base),width:bw,height:h-y(d.base), fill:"none", stroke:A3_PURPLE_2,"stroke-width":"1.2","stroke-dasharray":"6 4",opacity:"0.9"});
                    const bar = svgEl("rect",{x:gx,y:y(d.val),width:bw,height:h-y(d.val), fill:A3_PURPLE, rx:"5"});
                    g.appendChild(ghost); g.appendChild(bar);
                    ghosts.push(ghost); bars.push(bar);
                    const lab = svgEl("text",{x:gx+bw/2,y:y(d.val)-3,"text-anchor":"middle","font-weight":"700","font-size":"9",fill:"#333"},[]);
                    lab.textContent = d.val.toFixed(1); g.appendChild(lab); labels.push(lab);

                    bar.style.cursor="pointer";
                    bar.addEventListener("click",()=>{
                        d.mode = (d.mode+1)%3; let H=0, YY=0, color=A3_PURPLE;
                        if(d.mode===0){ H=h-y(d.val); YY=y(d.val); color=A3_PURPLE; }
                        if(d.mode===1){ H=h-y(d.base); YY=y(d.base); color=A3_TEAL; }
                        if(d.mode===2){ const delta=Math.max(0,d.val-d.base); H=h-y(delta); YY=y(delta); color=A3_GOLD; }
                        bar.setAttribute("y",YY); bar.setAttribute("height",H); bar.setAttribute("fill",color);
                        labels[i].textContent = d.mode===2? ("+"+(d.val-d.base).toFixed(1)) : (d.mode===1? d.base.toFixed(1): d.val.toFixed(1));
                        labels[i].setAttribute("y", YY-3);
                    });
                });

                svg.addEventListener("click",(e)=>{
                    if(e.target.tagName.toLowerCase()==="rect") return;
                    const byHeight = d=> d.mode===0? d.val : (d.mode===1? d.base : Math.max(0,d.val-d.base));
                    cats = cats.sort((a,b)=> byHeight(b)-byHeight(a));
                    cats.forEach((d,i)=>{
                        const gx = m.l + xBand(i);
                        bars[i].setAttribute("x", gx - m.l);
                        ghosts[i].setAttribute("x", gx - m.l);
                        labels[i].setAttribute("x", gx - m.l + bandW/2);
                    });
                });
            })();


            
            (function(){
                const svg = document.getElementById("c5"); if(!svg) return;
                svg.innerHTML = '';
                const W=480,H=150, m={t:6,r:8,b:18,l:30};
                const w=W-m.l-m.r, h=H-m.t-m.b;
                const g = svgEl("g",{transform:`translate(${m.l},${m.t})`}); svg.appendChild(g);
                drawGrid(g,0,0,w,h, w/7, h/5);
                drawAxes(g,0,0,w,h,7,5,[-2,5],[0,50]);

                function X(v){ return (v+2)/(5+2)*w; }
                function Y(v){ return (1-v/0.50)*h; }
                function norm(mu,s){ return x=> (1/(s*Math.sqrt(2*Math.PI)))*Math.exp(-0.5*((x-mu)/s)**2); }
                const f0 = norm(0.2,0.9), f1 = norm(2.0,0.8);
                const Xs = []; for(let x=-2; x<=5; x+=0.02) Xs.push(x);

                function linePath(data){ return data.map((d,i)=> (i? "L":"M") + X(d.x) + " " + Y(d.y)).join(" "); }
                const p0 = Xs.map(v=>({x:v,y:f0(v)})), p1 = Xs.map(v=>({x:v,y:f1(v)}));
                const path0 = svgEl("path",{d:linePath(p0), fill:"none", stroke:A3_TEAL,"stroke-width":"1.6"});
                const path1 = svgEl("path",{d:linePath(p1), fill:"none", stroke:A3_PURPLE,"stroke-width":"1.6"});
                g.appendChild(path0); g.appendChild(path1);

                const area0 = svgEl("path",{fill:`rgba(14,165,168,.25)`});
                const area1 = svgEl("path",{fill:`rgba(109,40,217,.25)`});
                g.appendChild(area0); g.appendChild(area1);

                const vL = svgEl("line",{"stroke":A3_ROSE,"stroke-dasharray":"6 4","display":"none"});
                const vR = svgEl("line",{"stroke":A3_ROSE,"stroke-dasharray":"6 4","display":"none"});
                g.appendChild(vL); g.appendChild(vR);

                const chip = svgEl("g",{transform:`translate(${X(3.0)},${Y(0.45)})`, opacity:"0"});
                chip.appendChild(svgEl("rect",{width:"148",height:"16",rx:"7",fill:A3_PURPLE}));
                const chipText = svgEl("text",{x:"7", y:"12", fill:"#fff", "font-size":"8","font-weight":"700"},[]);
                chipText.textContent="area: — / —"; chip.appendChild(chipText); g.appendChild(chip);

                let left=null, right=null;
                function updateShade(){
                    if(left===null || right===null) return;
                    const lo=Math.min(left,right), hi=Math.max(left,right);
                    const xs = Xs.filter(v=>v>=lo && v<=hi);
                    const dom0 = xs.filter(v=>f0(v)>=f1(v));
                    const dom1 = xs.filter(v=>f1(v)>f0(v));
                    function areaPath(xs, f){
                        if(xs.length===0) return "";
                        const top = xs.map((v,i)=> (i? "L":"M") + X(v) + " " + Y(f(v))).join(" ");
                        const base = "L " + X(xs[xs.length-1]) + " " + Y(0) + " L " + X(xs[0]) + " " + Y(0) + " Z";
                        return top + " " + base;
                    }
                    area0.setAttribute("d", areaPath(dom0, f0));
                    area1.setAttribute("d", areaPath(dom1, f1));
                    vL.setAttribute("x1",X(lo)); vL.setAttribute("x2",X(lo)); vL.setAttribute("y1",0); vL.setAttribute("y2",h); vL.removeAttribute("display");
                    vR.setAttribute("x1",X(hi)); vR.setAttribute("x2",X(hi)); vR.setAttribute("y1",0); vR.setAttribute("y2",h); vR.removeAttribute("display");

                    const dx = Xs[1]-Xs[0]; let a0=0, a1=0;
                    xs.forEach(v=>{ if(f0(v)>=f1(v)) a0+=f0(v)*dx; else a1+=f1(v)*dx; });
                    const total = a0+a1 || 1;
                    chipText.textContent = `area: teal ${(a0/total*100).toFixed(0)}% · purple ${(a1/total*100).toFixed(0)}%`;
                    chip.setAttribute("opacity","1");
                }

                svg.addEventListener("click",(e)=>{
                    const pt = svg.createSVGPoint(); pt.x=e.clientX; pt.y=e.clientY;
                    const local = pt.matrixTransform(svg.getScreenCTM().inverse());
                    const x = Math.max(m.l, Math.min(W-m.r, local.x)) - m.l;
                    const xv = (x/w)*(5+2) - 2;
                    if(left===null){ left = xv; }
                    else if(right===null){ right = xv; }
                    else { left = xv; right = null; area0.setAttribute("d",""); area1.setAttribute("d",""); chip.setAttribute("opacity","0"); vL.setAttribute("display","none"); vR.setAttribute("display","none"); }
                    updateShade();
                });
            })();

            
            initHeatmap();

            
            initLinechart();
        }


        
        const rawData1 = [{"Approach":"ERM","Metric Group":"Std Acc","Dataset":"CIFAR100","Value":81.03},{"Approach":"DA","Metric Group":"Std Acc","Dataset":"CIFAR100","Value":78.27},{"Approach":"PGDT","Metric Group":"Std Acc","Dataset":"CIFAR100","Value":64.35},{"Approach":"TRADES","Metric Group":"Std Acc","Dataset":"CIFAR100","Value":62.55},{"Approach":"MART","Metric Group":"Std Acc","Dataset":"CIFAR100","Value":63.68},{"Approach":"RS","Metric Group":"Std Acc","Dataset":"CIFAR100","Value":56.87},{"Approach":"IBP","Metric Group":"Std Acc","Dataset":"CIFAR100","Value":39.45},{"Approach":"PRL","Metric Group":"Std Acc","Dataset":"CIFAR100","Value":64.89},{"Approach":"TandT","Metric Group":"Std Acc","Dataset":"CIFAR100","Value":65.56},{"Approach":"ERM","Metric Group":"Std Acc","Dataset":"CIFAR10","Value":94.85},{"Approach":"DA","Metric Group":"Std Acc","Dataset":"CIFAR10","Value":94.21},{"Approach":"PGDT","Metric Group":"Std Acc","Dataset":"CIFAR10","Value":84.38},{"Approach":"TRADES","Metric Group":"Std Acc","Dataset":"CIFAR10","Value":80.42},{"Approach":"MART","Metric Group":"Std Acc","Dataset":"CIFAR10","Value":81.54},{"Approach":"RS","Metric Group":"Std Acc","Dataset":"CIFAR10","Value":89.45},{"Approach":"IBP","Metric Group":"Std Acc","Dataset":"CIFAR10","Value":48.4},{"Approach":"PRL","Metric Group":"Std Acc","Dataset":"CIFAR10","Value":93.82},{"Approach":"TandT","Metric Group":"Std Acc","Dataset":"CIFAR10","Value":94.23},{"Approach":"ERM","Metric Group":"Std Acc","Dataset":"SVHN","Value":94.44},{"Approach":"DA","Metric Group":"Std Acc","Dataset":"SVHN","Value":94.69},{"Approach":"PGDT","Metric Group":"Std Acc","Dataset":"SVHN","Value":91.19},{"Approach":"TRADES","Metric Group":"Std Acc","Dataset":"SVHN","Value":86.16},{"Approach":"MART","Metric Group":"Std Acc","Dataset":"SVHN","Value":90.2},{"Approach":"RS","Metric Group":"Std Acc","Dataset":"SVHN","Value":88.35},{"Approach":"IBP","Metric Group":"Std Acc","Dataset":"SVHN","Value":73.09},{"Approach":"PRL","Metric Group":"Std Acc","Dataset":"SVHN","Value":92},{"Approach":"TandT","Metric Group":"Std Acc","Dataset":"SVHN","Value":94.79},{"Approach":"ERM","Metric Group":"Std Acc","Dataset":"MNIST","Value":99.37},{"Approach":"DA","Metric Group":"Std Acc","Dataset":"MNIST","Value":99.42},{"Approach":"PGDT","Metric Group":"Std Acc","Dataset":"MNIST","Value":99.16},{"Approach":"TRADES","Metric Group":"Std Acc","Dataset":"MNIST","Value":99.1},{"Approach":"MART","Metric Group":"Std Acc","Dataset":"MNIST","Value":98.94},{"Approach":"RS","Metric Group":"Std Acc","Dataset":"MNIST","Value":97.16},{"Approach":"IBP","Metric Group":"Std Acc","Dataset":"MNIST","Value":97.78},{"Approach":"PRL","Metric Group":"Std Acc","Dataset":"MNIST","Value":99.32},{"Approach":"TandT","Metric Group":"Std Acc","Dataset":"MNIST","Value":99.32},{"Approach":"ERM","Metric Group":"CRR","Dataset":"CIFAR100","Value":9.28},{"Approach":"DA","Metric Group":"CRR","Dataset":"CIFAR100","Value":15.04},{"Approach":"PGDT","Metric Group":"CRR","Dataset":"CIFAR100","Value":57.07},{"Approach":"TRADES","Metric Group":"CRR","Dataset":"CIFAR100","Value":59.27},{"Approach":"MART","Metric Group":"CRR","Dataset":"CIFAR100","Value":58.79},{"Approach":"RS","Metric Group":"CRR","Dataset":"CIFAR100","Value":60.38},{"Approach":"IBP","Metric Group":"CRR","Dataset":"CIFAR100","Value":49.34},{"Approach":"PRL","Metric Group":"CRR","Dataset":"CIFAR100","Value":56.71},{"Approach":"TandT","Metric Group":"CRR","Dataset":"CIFAR100","Value":62.05},{"Approach":"ERM","Metric Group":"CRR","Dataset":"CIFAR10","Value":1.25},{"Approach":"DA","Metric Group":"CRR","Dataset":"CIFAR10","Value":81.08},{"Approach":"PGDT","Metric Group":"CRR","Dataset":"CIFAR10","Value":87.07},{"Approach":"TRADES","Metric Group":"CRR","Dataset":"CIFAR10","Value":88.54},{"Approach":"MART","Metric Group":"CRR","Dataset":"CIFAR10","Value":78.9},{"Approach":"RS","Metric Group":"CRR","Dataset":"CIFAR10","Value":90},{"Approach":"IBP","Metric Group":"CRR","Dataset":"CIFAR10","Value":54.7},{"Approach":"PRL","Metric Group":"CRR","Dataset":"CIFAR10","Value":90.71},{"Approach":"TandT","Metric Group":"CRR","Dataset":"CIFAR10","Value":95.08},{"Approach":"ERM","Metric Group":"CRR","Dataset":"SVHN","Value":52.72},{"Approach":"DA","Metric Group":"CRR","Dataset":"SVHN","Value":82.08},{"Approach":"PGDT","Metric Group":"CRR","Dataset":"SVHN","Value":87.89},{"Approach":"TRADES","Metric Group":"CRR","Dataset":"SVHN","Value":87.89},{"Approach":"MART","Metric Group":"CRR","Dataset":"SVHN","Value":85.23},{"Approach":"RS","Metric Group":"CRR","Dataset":"SVHN","Value":76.29},{"Approach":"IBP","Metric Group":"CRR","Dataset":"SVHN","Value":61.94},{"Approach":"PRL","Metric Group":"CRR","Dataset":"SVHN","Value":93.11},{"Approach":"TandT","Metric Group":"CRR","Dataset":"SVHN","Value":93.15},{"Approach":"ERM","Metric Group":"CRR","Dataset":"MNIST","Value":26.01},{"Approach":"DA","Metric Group":"CRR","Dataset":"MNIST","Value":85.23},{"Approach":"PGDT","Metric Group":"CRR","Dataset":"MNIST","Value":94.65},{"Approach":"TRADES","Metric Group":"CRR","Dataset":"MNIST","Value":94.76},{"Approach":"MART","Metric Group":"CRR","Dataset":"MNIST","Value":94.13},{"Approach":"RS","Metric Group":"CRR","Dataset":"MNIST","Value":87.15},{"Approach":"IBP","Metric Group":"CRR","Dataset":"MNIST","Value":89.18},{"Approach":"PRL","Metric Group":"CRR","Dataset":"MNIST","Value":96.03},{"Approach":"TandT","Metric Group":"CRR","Dataset":"MNIST","Value":97.8},{"Approach":"ERM","Metric Group":"CRA","Dataset":"CIFAR100","Value":4.52},{"Approach":"DA","Metric Group":"CRA","Dataset":"CIFAR100","Value":6.15},{"Approach":"PGDT","Metric Group":"CRA","Dataset":"CIFAR100","Value":32.93},{"Approach":"TRADES","Metric Group":"CRA","Dataset":"CIFAR100","Value":38.85},{"Approach":"MART","Metric Group":"CRA","Dataset":"CIFAR100","Value":49.37},{"Approach":"RS","Metric Group":"CRA","Dataset":"CIFAR100","Value":47.5},{"Approach":"IBP","Metric Group":"CRA","Dataset":"CIFAR100","Value":29.2},{"Approach":"PRL","Metric Group":"CRA","Dataset":"CIFAR100","Value":50.77},{"Approach":"TandT","Metric Group":"CRA","Dataset":"CIFAR100","Value":52.07},{"Approach":"ERM","Metric Group":"CRA","Dataset":"CIFAR10","Value":1.25},{"Approach":"DA","Metric Group":"CRA","Dataset":"CIFAR10","Value":76.07},{"Approach":"PGDT","Metric Group":"CRA","Dataset":"CIFAR10","Value":82.9},{"Approach":"TRADES","Metric Group":"CRA","Dataset":"CIFAR10","Value":78.8},{"Approach":"MART","Metric Group":"CRA","Dataset":"CIFAR10","Value":72.21},{"Approach":"RS","Metric Group":"CRA","Dataset":"CIFAR10","Value":87.98},{"Approach":"IBP","Metric Group":"CRA","Dataset":"CIFAR10","Value":40},{"Approach":"PRL","Metric Group":"CRA","Dataset":"CIFAR10","Value":90.63},{"Approach":"TandT","Metric Group":"CRA","Dataset":"CIFAR10","Value":91.75},{"Approach":"ERM","Metric Group":"CRA","Dataset":"SVHN","Value":51.04},{"Approach":"DA","Metric Group":"CRA","Dataset":"SVHN","Value":82.01},{"Approach":"PGDT","Metric Group":"CRA","Dataset":"SVHN","Value":86.68},{"Approach":"TRADES","Metric Group":"CRA","Dataset":"SVHN","Value":84.76},{"Approach":"MART","Metric Group":"CRA","Dataset":"SVHN","Value":78.82},{"Approach":"RS","Metric Group":"CRA","Dataset":"SVHN","Value":70.64},{"Approach":"IBP","Metric Group":"CRA","Dataset":"SVHN","Value":57.26},{"Approach":"PRL","Metric Group":"CRA","Dataset":"SVHN","Value":91.07},{"Approach":"TandT","Metric Group":"CRA","Dataset":"SVHN","Value":92.81},{"Approach":"ERM","Metric Group":"CRA","Dataset":"MNIST","Value":24.96},{"Approach":"DA","Metric Group":"CRA","Dataset":"MNIST","Value":84.12},{"Approach":"PGDT","Metric Group":"CRA","Dataset":"MNIST","Value":94.63},{"Approach":"TRADES","Metric Group":"CRA","Dataset":"MNIST","Value":94.61},{"Approach":"MART","Metric Group":"CRA","Dataset":"MNIST","Value":94.09},{"Approach":"RS","Metric Group":"CRA","Dataset":"MNIST","Value":86.29},{"Approach":"IBP","Metric Group":"CRA","Dataset":"MNIST","Value":88.51},{"Approach":"PRL","Metric Group":"CRA","Dataset":"MNIST","Value":95.01},{"Approach":"TandT","Metric Group":"CRA","Dataset":"MNIST","Value":96.8}];
        const rawData2 = [{"Attack":"No Attack","ERM":94.85,"DA":94.21,"PGDT":84.38,"TRADES":80.42,"MART":81.54,"RS":89.45,"IBP":48.4,"PRL":93.82,"TandT":94.23},{"Attack":"TIFGSM","ERM":35.1,"DA":33,"PGDT":65.7,"TRADES":62.9,"MART":69.1,"RS":45.4,"IBP":40.2,"PRL":34,"TandT":92.8},{"Attack":"MIFGSM","ERM":0,"DA":0,"PGDT":50.9,"TRADES":51.9,"MART":50.5,"RS":5.8,"IBP":38.1,"PRL":0,"TandT":92.8},{"Attack":"DIFGSM","ERM":1,"DA":0,"PGDT":51.75,"TRADES":50.5,"MART":53.6,"RS":4.1,"IBP":38.1,"PRL":3.1,"TandT":92.8},{"Attack":"VMIFGSM","ERM":0,"DA":0,"PGDT":51.1,"TRADES":50.9,"MART":51.9,"RS":4.1,"IBP":38.1,"PRL":0,"TandT":93.9},{"Attack":"TPGD","ERM":38.1,"DA":39.2,"PGDT":69.3,"TRADES":69.1,"MART":70.1,"RS":48.5,"IBP":50,"PRL":28.9,"TandT":91.8},{"Attack":"FGSM","ERM":29.9,"DA":25.8,"PGDT":57.95,"TRADES":54.6,"MART":61.9,"RS":28.9,"IBP":38.1,"PRL":25.8,"TandT":93.8},{"Attack":"RFGSM","ERM":0,"DA":0,"PGDT":49.15,"TRADES":50.4,"MART":48.5,"RS":3.7,"IBP":38.1,"PRL":0,"TandT":90},{"Attack":"BIM","ERM":0,"DA":0,"PGDT":52,"TRADES":57.2,"MART":47.4,"RS":2.1,"IBP":38.1,"PRL":0,"TandT":90.7},{"Attack":"FAB","ERM":1,"DA":2.1,"PGDT":43,"TRADES":46.4,"MART":40.2,"RS":5.3,"IBP":38.1,"PRL":4.1,"TandT":90.1},{"Attack":"CW","ERM":0,"DA":0,"PGDT":32.2,"TRADES":35.1,"MART":29.9,"RS":1,"IBP":40.2,"PRL":1,"TandT":92.9},{"Attack":"UPGD","ERM":0,"DA":0,"PGDT":49.85,"TRADES":50.5,"MART":49.8,"RS":5.1,"IBP":38.1,"PRL":0,"TandT":93.8},{"Attack":"FFGSM","ERM":19.6,"DA":23.7,"PGDT":60.55,"TRADES":55.7,"MART":66,"RS":33,"IBP":42.3,"PRL":29.9,"TandT":92.8},{"Attack":"Jitter","ERM":11.3,"DA":12.4,"PGDT":48.15,"TRADES":47.4,"MART":49.5,"RS":34,"IBP":39.2,"PRL":24.7,"TandT":90.7},{"Attack":"PGD","ERM":0,"DA":0,"PGDT":57.4,"TRADES":54.6,"MART":60.8,"RS":7.2,"IBP":40.2,"PRL":0,"TandT":91.8},{"Attack":"EOTPGD","ERM":0,"DA":0,"PGDT":50.1,"TRADES":50.3,"MART":50.5,"RS":3,"IBP":38.1,"PRL":0,"TandT":90.7},{"Attack":"APGD","ERM":0,"DA":0,"PGDT":48.4,"TRADES":51,"MART":46.4,"RS":1,"IBP":38.1,"PRL":0,"TandT":90.7},{"Attack":"NIFGSM","ERM":0,"DA":0,"PGDT":57.95,"TRADES":56.7,"MART":59.8,"RS":7.2,"IBP":38.1,"PRL":1,"TandT":92.8},{"Attack":"SiniFGSM","ERM":4.1,"DA":1,"PGDT":59,"TRADES":56.7,"MART":61.9,"RS":23.7,"IBP":38.1,"PRL":12.4,"TandT":93.7},{"Attack":"VNIFGSM","ERM":0,"DA":0,"PGDT":50.45,"TRADES":53,"MART":48.5,"RS":5.1,"IBP":38.1,"PRL":0,"TandT":92.9},{"Attack":"APGDT","ERM":0,"DA":0,"PGDT":40.9,"TRADES":44.3,"MART":38.1,"RS":0,"IBP":38.1,"PRL":0,"TandT":88.7},{"Attack":"Square","ERM":0,"DA":1,"PGDT":50.4,"TRADES":54,"MART":47.4,"RS":3.1,"IBP":38.1,"PRL":2.1,"TandT":88.08},{"Attack":"Add Gaussian Noise","ERM":25.8,"DA":43.3,"PGDT":79.1,"TRADES":78.4,"MART":80.4,"RS":74.2,"IBP":42.3,"PRL":45.4,"TandT":87.6},{"Attack":"OnePixel","ERM":79.4,"DA":83.5,"PGDT":78.05,"TRADES":74.2,"MART":82.5,"RS":83.5,"IBP":42.5,"PRL":80.4,"TandT":89.7},{"Attack":"Pixle","ERM":0,"DA":0,"PGDT":12.55,"TRADES":11.3,"MART":14.4,"RS":1,"IBP":10.3,"PRL":0,"TandT":17.5},{"Attack":"PGDL2","ERM":1,"DA":0,"PGDT":35.8,"TRADES":36.1,"MART":36.1,"RS":5.2,"IBP":36.1,"PRL":0,"TandT":92.9}];


        const tooltip = d3.select("#tooltip");

        function initHeatmap() {
            const margin = { top: 30, right: 20, bottom: 40, left: 80 },
                width = 800 - margin.left - margin.right, 
                height = 500 - margin.top - margin.bottom;

            const svg = d3.select("#heatmap")
                .attr("viewBox", `0 0 800 500`) 
                .html('').append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const approaches = Array.from(new Set(rawData1.map(d => d.Approach)));
            const datasets = ['CIFAR100', 'CIFAR10', 'SVHN', 'MNIST'];

            const x = d3.scaleBand().range([0, width]).domain(datasets).padding(0.05);
            const y = d3.scaleBand().range([height, 0]).domain(approaches).padding(0.05);
            const color = d3.scaleSequential([0, 100], d3.interpolateRgbBasis(['#440154', '#300063', '#a42967', '#ff8c00']));

            svg.append("g").attr("class", "x-axis").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x)).select(".domain").remove();
            svg.append("g").attr("class", "y-axis").call(d3.axisLeft(y)).select(".domain").remove();
            svg.selectAll(".x-axis text, .y-axis text").attr("class", "axis-label");

            function draw(metric) {
                const data = rawData1.filter(d => d["Metric Group"] === metric);
                const cells = svg.selectAll(".cell").data(data, d => d.Approach+d.Dataset);
               
                cells.enter().append("rect").attr("class", "cell")
                    .attr("x", d => x(d.Dataset)).attr("y", d => y(d.Approach))
                    .attr("width", x.bandwidth()).attr("height", y.bandwidth())
                    .attr("rx", 5).style("fill", d => color(d.Value))
                    .on("mouseover", (e,d) => {
                        tooltip.style("opacity", 1).html(`<div class="font-bold">${d.Approach}</div><div>${d.Dataset} - ${d["Metric Group"]}</div><div class="text-orange-400 text-lg">${d.Value.toFixed(2)}%</div>`)
                            .style("left", (e.pageX+10)+"px").style("top", (e.pageY-20)+"px");
                        d3.select(e.currentTarget).style("stroke", "#FFA726").style("stroke-width", "3px");
                    })
                    .on("mouseout", (e) => {
                             tooltip.style("opacity", 0);
                             d3.select(e.currentTarget).style("stroke", "#ffffff").style("stroke-width", "1px");
                    });
               
                cells.transition().duration(500).style("fill", d => color(d.Value));
                cells.exit().remove();

                svg.selectAll(".cell-text").data(data, d => d.Approach+d.Dataset)
                    .join(
                        enter => enter.append("text").attr("class", "cell-text").style("fill", "white").attr("text-anchor", "middle").attr("alignment-baseline", "middle").attr("font-size", "10px").attr("pointer-events", "none"),
                        update => update.transition().duration(500),
                        exit => exit.remove()
                    )
                    .attr("x", d => x(d.Dataset) + x.bandwidth() / 2)
                    .attr("y", d => y(d.Approach) + y.bandwidth() / 2)
                    .text(d => d.Value.toFixed(1));
            }

            draw("Std Acc");
            d3.select("#metric-select").on("change", function() { draw(this.value); });
           
      
            const lSvg = d3.select("#legend");
            const legendWidth = 300;
            lSvg.attr("width", legendWidth).attr("height", 40);
            const defs = lSvg.append("defs");
            const grad = defs.append("linearGradient").attr("id", "lg").attr("x1", "0%").attr("x2", "100%");
            ['#440154', '#300063', '#a42967', '#ff8c00'].forEach((c,i) => grad.append("stop").attr("offset", (i * (100 / 3)) + "%").attr("stop-color", c));
            lSvg.append("rect").attr("width", legendWidth).attr("height", 20).style("fill", "url(#lg)");

            const lAxisScale = d3.scaleLinear().range([0, legendWidth]).domain([0, 100]);
            const lAxis = d3.axisBottom(lAxisScale).tickValues([0, 25, 50, 75, 100]).tickFormat(d => d + "%").tickSize(6);
            lSvg.append("g").attr("transform", `translate(0, 20)`).call(lAxis).select(".domain").remove();
            lSvg.selectAll(".tick text").attr("class", "axis-label");
        }

        function initLinechart() {
            const margin = { top: 20, right: 100, bottom: 100, left: 50 },
                width = 900 - margin.left - margin.right, 
                height = 500 - margin.top - margin.bottom;

            const svg = d3.select("#linechart")
                .attr("viewBox", `0 0 900 500`)
                .html('').append("g").attr("transform", `translate(${margin.left},${margin.top})`);

            const approaches = Object.keys(rawData2[0]).filter(k => k !== 'Attack');
            const attacks = rawData2.map(d => d.Attack);
            let visible = ["TandT", "PGDT", "ERM"];
           
            const x = d3.scalePoint().domain(attacks).range([0, width]);
            const y = d3.scaleLinear().domain([0, 100]).range([height, 0]);
            const color = d3.scaleOrdinal(d3.schemeCategory10).domain(approaches);

            svg.append("g").attr("class", "x-axis").attr("transform", `translate(0,${height})`).call(d3.axisBottom(x)).selectAll("text")
                .attr("class", "axis-label").attr("transform", "rotate(-45)").style("text-anchor", "end").attr("dx", "-.8em").attr("dy", ".15em");
            svg.append("g").attr("class", "y-axis").call(d3.axisLeft(y));
            svg.selectAll(".y-axis text").attr("class", "axis-label");


            const line = d3.line().x(d => x(d.Attack)).y(d => y(d.val));

            
            const ctrls = d3.select("#approach-controls");
            ctrls.html('');
            approaches.forEach(app => {
                const l = ctrls.append("label").attr("class", "flex items-center gap-2 cursor-pointer border rounded px-2 py-1 bg-white shadow-sm text-sm");
                l.append("input").attr("type", "checkbox").property("checked", visible.includes(app))
                    .on("change", function() {
                        if(this.checked) visible.push(app); else visible = visible.filter(v => v !== app);
                        update();
                    });
                l.append("span").text(app).style("color", color(app));
            });

            function update() {
                const filtered = approaches.filter(a => visible.includes(a)).map(app => {
                    return { name: app, vals: rawData2.map(d => ({ Attack: d.Attack, val: d[app] })) };
                });

                const paths = svg.selectAll(".line").data(filtered, d => d.name);
                paths.enter().append("path").attr("class", "line").attr("fill", "none").attr("stroke-width", 2)
                    .merge(paths).transition().duration(500).attr("d", d => line(d.vals)).attr("stroke", d => color(d.name));
                paths.exit().remove();
            }
            update();
        }

        
        initAllScripts();
    </script>
</body>
</html>
