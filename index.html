<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combined IDV Assignments Portfolio</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        /* --- GLOBAL STYLES (Based on Assignment 4 Theme) --- */
        :root {
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #333333;
            --accent-color: #4a90e2; /* Professional Blue */
            --border-color: #e0e0e0;
            --shadow: 0 2px 4px rgba(0,0,0,0.05);
            --font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        header {
            background-color: #2c3e50;
            color: white;
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        header h1 { margin: 0; font-size: 1.5rem; }
        header nav a { color: #ecf0f1; text-decoration: none; margin-left: 20px; font-size: 0.9rem; }
        header nav a:hover { text-decoration: underline; }

        main {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        section {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 3rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        h2 { border-bottom: 2px solid var(--bg-color); padding-bottom: 0.5rem; color: #2c3e50; }
        h3 { color: #555; font-weight: 600; font-size: 1.1rem; margin-top: 1.5rem;}

        /* Controls Area */
        .controls {
            background: #f1f3f5;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        button, select {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: white;
            cursor: pointer;
        }
        button:hover { background: #e9ecef; }

        /* --- ASSIGNMENT 1: PSI TABLE --- */
        table.psi-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        .psi-table th, .psi-table td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }
        .psi-table th { background-color: #f1f1f1; }
        .psi-status { font-weight: bold; }

        /* --- ASSIGNMENT 2: SVG EFFECTS --- */
        .svg-gallery {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            text-align: center;
        }
        .svg-cell { border: 1px solid #eee; padding: 10px; }
        .svg-cell svg { width: 50px; height: 50px; fill: var(--accent-color); transition: 0.3s; }
        
        /* Transforms */
        .effect-mirror svg { transform: scaleX(-1); }
        .effect-rotate svg { transform: rotate(180deg); }
        .effect-squeeze svg { transform: scaleY(0.5); transform-origin: center; }
        .effect-grayscale svg { filter: grayscale(100%); fill: #888; /* Simulate grayscale on fill */ }

        /* --- ASSIGNMENT 3: INTERACTIVE CHARTS --- */
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .chart-container {
            border: 1px solid #eee;
            padding: 10px;
            height: 250px;
            position: relative;
        }
        .chart-title { font-size: 0.9rem; font-weight: bold; margin-bottom: 5px; display: block;}

        /* --- ASSIGNMENT 4: DASHBOARD STYLES --- */
        .dashboard-row { display: flex; flex-wrap: wrap; gap: 20px; }
        .viz-box { flex: 1; min-width: 400px; height: 400px; }
        
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px;
            border-radius: 3px;
            pointer-events: none;
            opacity: 0;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>

<header>
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1>Combined IDV Portfolio</h1>
        <nav>
            <a href="#assign1">PSI Readings</a>
            <a href="#assign2">SVG Effects</a>
            <a href="#assign3">Interactive Charts</a>
            <a href="#assign4">Dashboard</a>
        </nav>
    </div>
</header>

<main>

    <section id="assign1">
        <h2>1. Singapore PSI Readings</h2>
        <div class="controls">
            <span>Data Source: data.gov.sg</span>
            <button onclick="fetchPSIData()">Refresh Data</button>
        </div>
        <div id="psi-container">Loading data...</div>
    </section>

    <section id="assign2">
        <h2>2. SVG Effects Gallery (10x5)</h2>
        <p>Demonstrating CSS transforms on SVG elements.</p>
        <div style="overflow-x: auto;">
            <div style="display: grid; grid-template-columns: repeat(5, 1fr); font-weight: bold; padding: 10px; background: #eee;">
                <div>Original</div><div>Mirrored</div><div>Rotated 180Â°</div><div>Squeezed (50%)</div><div>Grayscale</div>
            </div>
            <div id="svg-gallery-container"></div>
        </div>
    </section>

    <section id="assign3">
        <h2>3. Interactive Charts</h2>
        <p>Five interactive D3.js visualizations. Click interactions enabled.</p>
        <div class="chart-grid">
            <div class="chart-container" id="chart-opt">
                <span class="chart-title">1) Optimisation Route (Click to set goal)</span>
            </div>
            <div class="chart-container" id="chart-area">
                <span class="chart-title">2) Frequency Area (Click legend)</span>
            </div>
            <div class="chart-container" id="chart-venn">
                <span class="chart-title">3) Venn Diagram (Click center)</span>
            </div>
            <div class="chart-container" id="chart-bar">
                <span class="chart-title">4) CV Accuracy (Click to sort)</span>
            </div>
            <div class="chart-container" id="chart-density">
                <span class="chart-title">5) Probability Density (Click to shade)</span>
            </div>
        </div>
    </section>

    <section id="assign4">
        <h2>4. Metric Comparison & Attack Vulnerability</h2>
        
        <div class="controls">
            <label>Metric: 
                <select id="metric-select">
                    <option value="acc">Standard Accuracy</option>
                    <option value="crr">Certified Robustness Rate</option>
                    <option value="cra">Certified Robust Accuracy</option>
                </select>
            </label>
            <label><input type="checkbox" checked id="toggle-attack"> Show Attack Vector</label>
        </div>

        <div class="dashboard-row">
            <div class="viz-box" id="heatmap-viz">
                <h3>Metric Heatmap</h3>
            </div>
            <div class="viz-box" id="linechart-viz">
                <h3>Attack Line Chart</h3>
            </div>
        </div>
    </section>

</main>

<script>
    /* =========================================
       ASSIGNMENT 1: PSI FETCH
       ========================================= */
    async function fetchPSIData() {
        const container = document.getElementById('psi-container');
        container.innerHTML = "Fetching...";
        try {
            const response = await fetch('https://api.data.gov.sg/v1/environment/psi');
            const data = await response.json();
            const readings = data.items[0].readings;
            const timestamp = data.items[0].timestamp;
            
            let html = `<p>Updated: ${new Date(timestamp).toLocaleString()}</p>`;
            html += `<table class="psi-table"><thead><tr><th>Metric</th><th>West</th><th>East</th><th>Central</th><th>South</th><th>North</th></tr></thead><tbody>`;
            
            for (const [metric, values] of Object.entries(readings)) {
                html += `<tr>
                    <td>${metric}</td>
                    <td>${values.west}</td>
                    <td>${values.east}</td>
                    <td>${values.central}</td>
                    <td>${values.south}</td>
                    <td>${values.north}</td>
                </tr>`;
            }
            html += `</tbody></table>`;
            container.innerHTML = html;
        } catch (e) {
            container.innerHTML = "Error loading PSI data.";
            console.error(e);
        }
    }
    fetchPSIData(); // Init

    /* =========================================
       ASSIGNMENT 2: SVG GALLERY
       ========================================= */
    function renderGallery() {
        const container = document.getElementById('svg-gallery-container');
        // Generate 10 rows
        for(let i=0; i<10; i++) {
            const row = document.createElement('div');
            row.className = 'svg-gallery';
            
            // 5 Effects
            const effects = ['', 'effect-mirror', 'effect-rotate', 'effect-squeeze', 'effect-grayscale'];
            
            effects.forEach(effect => {
                const cell = document.createElement('div');
                cell.className = `svg-cell ${effect}`;
                // Use a standard shape (Star)
                cell.innerHTML = `
                    <svg viewBox="0 0 24 24">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>`;
                row.appendChild(cell);
            });
            container.appendChild(row);
        }
    }
    renderGallery();

    /* =========================================
       ASSIGNMENT 3: INTERACTIVE CHARTS (Simulated)
       ========================================= */
    
    // 1. Optimisation Route (Simple Scatter + Path)
    {
        const svg = d3.select("#chart-opt").append("svg").attr("width", "100%").attr("height", "100%");
        const width = 300, height = 220;
        let data = d3.range(20).map(i => ({x: i*15 + 10, y: 100 + Math.sin(i)*50}));
        
        const path = svg.append("path").datum(data).attr("fill", "none").attr("stroke", "#4a90e2").attr("stroke-width", 2);
        const line = d3.line().curve(d3.curveBasis).x(d => d.x).y(d => d.y);
        path.attr("d", line);

        svg.on("click", function(event) {
            const [mx, my] = d3.pointer(event);
            data.push({x: mx, y: my});
            data.sort((a,b) => a.x - b.x); // simple reorder
            path.transition().duration(1000).attr("d", line);
            svg.append("circle").attr("cx", mx).attr("cy", my).attr("r", 3).attr("fill", "red").transition().duration(1000).attr("r", 0).remove();
        });
    }

    // 2. Frequency Area
    {
        const svg = d3.select("#chart-area").append("svg").attr("width", "100%").attr("height", "100%");
        const data = d3.range(10).map(i => ({x: i, y1: Math.random()*50, y2: Math.random()*50}));
        const area = d3.area().x(d => d.x * 30 + 10).y0(200).y1(d => 200 - d.y1);
        
        svg.append("path").datum(data).attr("d", area).attr("fill", "rgba(74, 144, 226, 0.5)").attr("stroke", "#4a90e2");
        
        // Legend toggle simulation
        svg.append("rect").attr("x", 10).attr("y", 10).attr("width", 10).attr("height", 10).attr("fill", "#4a90e2")
           .on("click", function() {
               const p = svg.select("path");
               const op = p.attr("opacity") == 0 ? 1 : 0;
               p.transition().attr("opacity", op);
           });
        svg.append("text").attr("x", 25).attr("y", 20).text("Toggle Series").style("font-size", "10px");
    }

    // 3. Venn
    {
        const svg = d3.select("#chart-venn").append("svg").attr("width", "100%").attr("height", "100%");
        const circles = [
            {x: 100, y: 100, color: "red"}, {x: 160, y: 100, color: "blue"}, {x: 130, y: 150, color: "green"}
        ];
        svg.selectAll("circle").data(circles).enter().append("circle")
           .attr("cx", d => d.x).attr("cy", d => d.y).attr("r", 50)
           .style("fill", d => d.color).style("opacity", 0.5)
           .style("mix-blend-mode", "multiply")
           .on("click", function() {
               d3.select(this).transition().attr("r", 60).transition().attr("r", 50);
           });
        svg.append("text").attr("x", 130).attr("y", 125).text("Click Me").attr("text-anchor", "middle").style("font-size", "10px");
    }

    // 4. CV Accuracy (Bar Chart Sort)
    {
        const svg = d3.select("#chart-bar").append("svg").attr("width", "100%").attr("height", "100%");
        let data = [10, 50, 30, 80, 20, 60];
        
        function drawBars() {
            const bars = svg.selectAll("rect").data(data);
            bars.enter().append("rect")
                .merge(bars)
                .attr("x", (d, i) => i * 40 + 10)
                .attr("width", 30)
                .attr("y", d => 200 - d * 2)
                .attr("height", d => d * 2)
                .attr("fill", "#4a90e2")
                .on("click", function(e, d) {
                    d3.select(this).attr("fill", "orange");
                });
        }
        drawBars();
        svg.on("click", () => {
            data.sort((a,b) => b - a);
            svg.selectAll("rect").transition().duration(500)
               .attr("y", d => 200 - d * 2).attr("height", d => d * 2);
        });
    }

    // 5. Density
    {
        const svg = d3.select("#chart-density").append("svg").attr("width", "100%").attr("height", "100%");
        // Simple bell curve
        const data = d3.range(-10, 10, 0.5).map(x => ({x: x, y: (1/(Math.sqrt(2*Math.PI))) * Math.exp(-0.5 * x * x)}));
        const x = d3.scaleLinear().domain([-5, 5]).range([0, 300]);
        const y = d3.scaleLinear().domain([0, 0.5]).range([200, 0]);
        
        const area = d3.area().x(d => x(d.x)).y0(200).y1(d => y(d.y));
        
        svg.append("path").datum(data).attr("d", area).attr("fill", "#ccc").attr("stroke", "#333");
        
        svg.on("click", function(event) {
             const [mx, my] = d3.pointer(event);
             svg.append("line").attr("x1", mx).attr("y1", 0).attr("x2", mx).attr("y2", 200).attr("stroke", "red").style("stroke-dasharray", "3,3");
        });
    }

    /* =========================================
       ASSIGNMENT 4: DASHBOARD VIZ
       ========================================= */
    const heatmapSvg = d3.select("#heatmap-viz").append("svg").attr("width", "100%").attr("height", "100%");
    const lineSvg = d3.select("#linechart-viz").append("svg").attr("width", "100%").attr("height", "100%");

    // Dummy Data
    const models = ["ResNet", "VGG", "DenseNet", "Inception"];
    const datasets = ["CIFAR10", "ImageNet", "SVHN"];
    
    function updateDashboard() {
        const metric = document.getElementById('metric-select').value;
        
        // Heatmap
        heatmapSvg.selectAll("*").remove();
        const gridSize = 80;
        models.forEach((m, i) => {
            datasets.forEach((d, j) => {
                const val = Math.random();
                heatmapSvg.append("rect")
                    .attr("x", j * gridSize + 50)
                    .attr("y", i * gridSize + 50)
                    .attr("width", gridSize - 2).attr("height", gridSize - 2)
                    .attr("fill", d3.interpolateBlues(val))
                    .append("title").text(`${m} - ${d}: ${val.toFixed(2)}`);
            });
            heatmapSvg.append("text").attr("x", 10).attr("y", i * gridSize + 100).text(m).style("font-size", "12px");
        });
        
        // Line Chart
        lineSvg.selectAll("*").remove();
        const lineData = d3.range(10).map(i => ({x: i, y: Math.random() * 100}));
        const line = d3.line().x(d => d.x * 40 + 20).y(d => 300 - d.y * 2);
        
        lineSvg.append("path").datum(lineData)
            .attr("fill", "none").attr("stroke", "#4a90e2").attr("stroke-width", 3)
            .attr("d", line);
            
        // Checkbox interaction
        if(document.getElementById('toggle-attack').checked) {
             lineSvg.append("path").datum(lineData.map(d => ({x: d.x, y: d.y * 0.8})))
                .attr("fill", "none").attr("stroke", "red").attr("stroke-width", 2).style("stroke-dasharray", "5,5")
                .attr("d", line);
        }
    }

    document.getElementById('metric-select').addEventListener('change', updateDashboard);
    document.getElementById('toggle-attack').addEventListener('change', updateDashboard);
    updateDashboard(); // Init

</script>
</body>
</html>
